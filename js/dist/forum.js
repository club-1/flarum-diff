module.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=23)}([function(t,e){t.exports=flarum.core.compat["common/app"]},function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e,i){"use strict";function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)}i.d(e,"a",(function(){return o}))},function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["common/helpers/username"]},function(t,e){t.exports=flarum.core.compat["common/helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["common/utils/extractText"]},,function(t,e){t.exports=flarum.core.compat["common/components/Tooltip"]},function(t,e){t.exports=flarum.core.compat["common/models/Post"]},function(t,e){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["common/helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,e){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["forum/components/CommentPost"]},function(t,e){t.exports=flarum.core.compat["common/utils/mixin"]},function(t,e){t.exports=flarum.core.compat["common/Component"]},function(t,e){t.exports=flarum.core.compat["common/components/Modal"]},function(t,e){t.exports=flarum.core.compat["common/components/Alert"]},function(t,e){t.exports=flarum.core.compat["forum/components/DiscussionPage"]},,,function(t,e,i){"use strict";i.r(e);var s=i(0),o=i.n(s),n=i(14),r=i(15),a=i.n(r),l=i(2),c=i(1),f=i.n(c),d=i(16),u=function(t){function e(){return t.apply(this,arguments)||this}return Object(l.a)(e,t),e}(i.n(d)()(f.a,{revision:f.a.attribute("revision"),createdAt:f.a.attribute("createdAt",f.a.transformDate),deletedAt:f.a.attribute("deletedAt",f.a.transformDate),rollbackedAt:f.a.attribute("rollbackedAt",f.a.transformDate),actor:f.a.hasOne("actor"),deletedUser:f.a.hasOne("deletedUser"),rollbackedUser:f.a.hasOne("rollbackedUser"),inlineHtml:f.a.attribute("inlineHtml"),sideBySideHtml:f.a.attribute("sideBySideHtml"),combinedHtml:f.a.attribute("combinedHtml"),previewHtml:f.a.attribute("previewHtml"),comparisonBetween:f.a.attribute("comparisonBetween")})),p=i(9),h=i.n(p),v=i(10),b=i.n(v),w=i(17),g=i.n(w),S=i(3),y=i.n(S),k=i(11),B=i.n(k),C=i(12),D=i.n(C),I=i(4),N=i.n(I),x=i(5),H=i.n(x),A=i(6),M=i.n(A),O=function(t){function e(){return t.apply(this,arguments)||this}Object(l.a)(e,t);var i=e.prototype;return i.view=function(){var t=Object.assign({},this.attrs);return delete t.item,delete t.subButton,delete t.postDate,t.type="button",m("button",t,this.getButtonContent())},i.getButtonContent=function(){var t=this.attrs.item,e=t.actor(),i=0==t.revision()?M()(app.translator.trans("the-turk-diff.forum.createdInfo",{username:N()(t.actor()),ago:H()(this.attrs.postDate)})):M()(app.translator.trans("the-turk-diff.forum.editedInfo",{username:N()(t.actor()),ago:H()(t.createdAt())}));return t.deletedAt()&&(!1===this.attrs.subButton?i=i+" "+app.translator.trans("the-turk-diff.forum.deletedText"):(e=t.deletedUser(),i=M()(app.translator.trans("the-turk-diff.forum.deletedInfo",{username:N()(t.deletedUser()),ago:H()(t.deletedAt())})))),[e.username()?B()(e):"",t.deletedAt()&&!1===this.attrs.subButton?D()("fas fa-caret-down",{className:"Button-caret"}):"",m("span",{className:"Button-label",title:i},t.deletedAt()&&!0===this.attrs.subButton?m("em",null,i):i)]},e}(y.a),P=i(18),T=i.n(P),j=i(8),L=i.n(j);function E(t){return t.save({}).then((function(){return m.redraw()}))}var R=i(19),_=i.n(R),V=i(13),U=i.n(V),F=function(t){function e(){return t.apply(this,arguments)||this}Object(l.a)(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!1,this.showing=!1,this.diffId=null,this.comparisonBetween=JSON.parse(this.attrs.listState.selectedItem.comparisonBetween())},i.className=function(){return"DiffModal"},i.title=function(){return[this.attrs.listState.selectedItem.actor().username()?B()(this.attrs.listState.selectedItem.actor()):"",0!=this.attrs.listState.selectedItem.revision()?o.a.translator.trans("the-turk-diff.forum.editedInfo",{username:m("a",{href:o.a.route.user(this.attrs.listState.selectedItem.actor()),config:m.route},N()(this.attrs.listState.selectedItem.actor())),ago:H()(this.attrs.listState.selectedItem.createdAt())}):o.a.translator.trans("the-turk-diff.forum.createdInfo",{username:m("a",{href:o.a.route.user(this.attrs.listState.selectedItem.actor()),config:m.route},N()(this.attrs.listState.selectedItem.actor())),ago:H()(this.attrs.listState.post.createdAt())})]},i.oncreate=function(e){t.prototype.oncreate.call(this,e),this.config(e)},i.onupdate=function(t){this.config(t)},i.config=function(t){if(this.showing&&!$(".ModalManager").hasClass("in")&&$(".ModalManager").addClass("in"),this.diffId!==this.attrs.listState.selectedItem.id())return this.showing=!0,this.diffId=this.attrs.listState.selectedItem.id(),this.comparisonBetween=JSON.parse(this.attrs.listState.selectedItem.comparisonBetween()),0!=this.attrs.listState.selectedItem.revision()&&this.comparisonBetween.new.revision!=this.comparisonBetween.old.revision?this.setDiffContent(o.a.session.user.preferences().diffRenderer?o.a.session.user.preferences().diffRenderer:"sideBySide"):this.setDiffContent("preview")},i.view=function(){var t=this;return m("div",{className:"Modal modal-dialog "+this.className()},m("div",{className:"Modal-content"},m("div",{className:"Modal-close App-backControl"},y.a.component({icon:"fas fa-times",onclick:this.hide.bind(this),className:"Button Button--icon Button--link"})),this.attrs.listState.post.canDeleteEditHistory()&&this.attrs.listState.selectedItem.revision()!=this.attrs.listState.post.revisionCount()||this.attrs.listState.post.canRollbackEditHistory()&&this.$(".DeletedDiff").length!=this.attrs.listState.post.revisionCount()?m(b.a,{className:"diffCotrollerDropdown App-primaryControl",icon:"fas fa-ellipsis-v",buttonClassName:"Button",menuClassName:"Dropdown-menu--right",label:o.a.translator.trans("the-turk-diff.forum.optionsButton")},this.attrs.listState.post.canRollbackEditHistory()&&this.comparisonBetween.old.diffId?y.a.component({icon:"fas fa-reply",onclick:function(){if(confirm(o.a.translator.trans("the-turk-diff.forum.confirmRollback",{number:t.attrs.listState.selectedItem.revision()}))){t.loading=!0,m.redraw();var e=t.attrs.listState.selectedItem.revision()==t.attrs.listState.post.revisionCount()?t.comparisonBetween.old.diffId:t.attrs.listState.selectedItem.id();o.a.request({url:o.a.forum.attribute("apiUrl")+"/diff/"+e,method:"POST"}).then((function(){E(t.attrs.listState.post),o.a.modal.close(),o.a.cache.diffs&&o.a.cache.diffs[t.attrs.listState.post.id()]&&delete o.a.cache.diffs[t.attrs.listState.post.id()],t.showAlert("success","rollback")})).catch((function(){t.loading=!1,m.redraw(),E(t.attrs.listState.post),t.showAlert("error","rollback")}))}}},0==this.attrs.listState.selectedItem.revision()?o.a.translator.trans("the-turk-diff.forum.rollbackToOriginalButton"):this.attrs.listState.selectedItem.revision()==this.attrs.listState.post.revisionCount()?0!=this.comparisonBetween.old.revision?o.a.translator.trans("the-turk-diff.forum.revertChangesButton"):o.a.translator.trans("the-turk-diff.forum.rollbackToOriginalButton"):o.a.translator.trans("the-turk-diff.forum.rollbackButton",{number:this.attrs.listState.selectedItem.revision()})):"",this.attrs.listState.post.canDeleteEditHistory()&&this.attrs.listState.selectedItem.revision()!=this.attrs.listState.post.revisionCount()?y.a.component({icon:"far fa-trash-alt",onclick:function(){confirm(o.a.translator.trans("the-turk-diff.forum.confirmDelete"))&&(t.loading=!0,m.redraw(),t.attrs.listState.selectedItem.delete().then((function(){o.a.modal.close(),o.a.cache.diffs&&o.a.cache.diffs[t.attrs.listState.post.id()]&&delete o.a.cache.diffs[t.attrs.listState.post.id()],t.showAlert("success","delete")})).catch((function(){t.loading=!1,m.redraw(),t.showAlert("error","delete")})))}},o.a.translator.trans("the-turk-diff.forum.deleteButton")):""):"",m("div",{className:"Modal-header"},m("h3",{className:"App-titleControl App-titleControl--text"},this.title())),this.content()))},i.content=function(){var t=this,e=this.attrs.listState.post.revisionCount();return[m("div",{className:"diff-grid"},m("div",{className:"diff-grid-item diff-grid-controls"},m("div",{className:"diffSwitcher"},0!=this.attrs.listState.selectedItem.revision()&&this.comparisonBetween.new.revision!=this.comparisonBetween.old.revision?[{type:"inline",icon:"fas fa-grip-lines",class:"inlineView"},{type:"sideBySide",icon:"fas fa-columns",class:"sideBySideView"},{type:"combined",icon:"far fa-square",class:"combinedView"}].map((function(e){return m(L.a,{showOnFocus:!1,text:o.a.translator.trans("the-turk-diff.forum.tooltips."+e.type)},m("div",{className:"tooltip-wrapper"},m(y.a,{icon:e.icon,onclick:function(){return t.setDiffContent(e.type)},className:"Button Button--icon Button--link "+e.class})))})):"",m(L.a,{showOnFocus:!1,text:o.a.translator.trans("the-turk-diff.forum.tooltips.preview")},m("div",{className:"tooltip-wrapper"},m(y.a,{icon:"far fa-eye",onclick:function(){return t.setDiffContent("preview")},className:"Button Button--icon Button--link diffPreview"}))))),m("div",{className:"diff-grid-item diff-grid-info"},m("div",{className:"revisionInfo"},m("h4",null,o.a.translator.trans("the-turk-diff.forum.revisions",{revisionCount:e})),m("p",{class:"diffInfoContainer"}))),m("div",{className:"diff-grid-item diff-grid-revisions"},m(W,{state:this.attrs.listState})),m("div",{className:"diff-grid-item diff-grid-diff"},m("div",{className:"diffContents"},m("div",{className:"previewContainer Post-body"+(!1===o.a.forum.attribute("textFormattingForDiffPreviews")?" diff-skip-formatting":"")},this.renderHtml(this.attrs.listState.selectedItem.data.attributes.previewHtml)),m("div",{className:"diffContainer"}))),this.loading?m(U.a,{containerClassName:"DiffModal-loading",size:"large"}):"")]},i.onready=function(){var t=this.$(".DiffList-content"),e=this.$("li#parentDiff"+this.attrs.listState.selectedItem.id());t.animate({scrollTop:e.offset().top-t.offset().top+t.scrollTop()})},i.showAlert=function(t,e){var i={success:"the-turk-diff.forum."+e+"SuccessMessage",error:"the-turk-diff.forum."+e+"ErrorMessage"}[t];o.a.alerts.show(_.a,{type:t},o.a.translator.trans(i))},i.renderHtml=function(t){return m.trust(t)},i.setDiffContent=function(t){var e,i=this.$(".diffContainer"),s=this.$(".previewContainer"),n=this.$(".Button.sideBySideView"),r=this.$(".Button.inlineView"),a=this.$(".Button.combinedView"),l=this.$(".Button.diffPreview");return"preview"===t?(i.hide(),this.$(".previewContainer").show(),l.prop("disabled",!0),l.parent().siblings().children().prop("disabled",!1),this.setInfoContent(!0)):("sideBySide"===t?(e=this.renderHtml(this.attrs.listState.selectedItem.data.attributes.sideBySideHtml),n.prop("disabled",!0),n.parent().siblings().children().prop("disabled",!1)):"inline"===t?(e=this.renderHtml(this.attrs.listState.selectedItem.data.attributes.inlineHtml),r.prop("disabled",!0),r.parent().siblings().children().prop("disabled",!1)):"combined"===t&&(e=this.renderHtml(this.attrs.listState.selectedItem.data.attributes.combinedHtml),a.prop("disabled",!0),a.parent().siblings().children().prop("disabled",!1)),e?(i.html(e.children),s.is(":visible")&&(i.show(),s.hide()),o.a.session.user.savePreferences({diffRenderer:t}),this.setInfoContent()):void 0)},i.setInfoContent=function(t){void 0===t&&(t=!1);var e=this.$(".diffInfoContainer"),i=t||0==this.attrs.listState.selectedItem.revision()||this.comparisonBetween.new.revision==this.comparisonBetween.old.revision?M()(o.a.translator.trans("the-turk-diff.forum.previewMode.sentence",{content:0==this.comparisonBetween.new.revision?o.a.translator.trans("the-turk-diff.forum.previewMode.originalContent"):this.comparisonBetween.new.revision==this.attrs.listState.post.revisionCount()?o.a.translator.trans("the-turk-diff.forum.previewMode.currentContent"):o.a.translator.trans("the-turk-diff.forum.previewMode.revisionWithNumber",{number:this.comparisonBetween.new.revision})})):M()(o.a.translator.trans("the-turk-diff.forum.differences.sentence",{old:-1==this.comparisonBetween.old.revision?o.a.translator.trans("the-turk-diff.forum.differences.currentContent"):0==this.comparisonBetween.old.revision?o.a.translator.trans("the-turk-diff.forum.differences.originalContent"):o.a.translator.trans("the-turk-diff.forum.differences.revisionWithNumber",{number:this.comparisonBetween.old.revision}),new:0==this.comparisonBetween.new.revision?o.a.translator.trans("the-turk-diff.forum.differences.originalContent"):this.comparisonBetween.new.revision==this.attrs.listState.post.revisionCount()?o.a.translator.trans("the-turk-diff.forum.differences.currentContent"):o.a.translator.trans("the-turk-diff.forum.differences.revisionWithNumber",{number:this.comparisonBetween.new.revision})}));return e.html(i)},e}(T.a),W=function(t){function e(){return t.apply(this,arguments)||this}Object(l.a)(e,t);var i=e.prototype;return i.view=function(){var t=this,e=this.attrs.state,i=o.a.cache.diffs[e.post.id()]||[];return m("div",{className:"DiffList-container"},m("div",{className:"DiffList-content"},m("ul",null,i.length?i.map((function(i){return i.map((function(i){var s=m(L.a,{showOnFocus:!1,position:"left",text:i.revision()==e.post.revisionCount()?o.a.translator.trans("the-turk-diff.forum.tooltips.mostRecent"):0==i.revision()?o.a.translator.trans("the-turk-diff.forum.tooltips.originalContent"):o.a.translator.trans("the-turk-diff.forum.tooltips.revisionWithNumber",{number:i.revision()})},O.component({"data-container":"body",postDate:e.post.createdAt(),subButton:!1,item:i,onclick:function(){if(i.deletedAt())t.toggleSubDiff(i.id());else if($(".diffListTooltip").remove(),e.selectedItem=i,o.a.modal.show(F,{listState:e}),e.forModal){var s=t.$("li#parentDiff"+i.id());s.find("button").prop("disabled",!0),s.siblings().find("button").prop("disabled",!1),s.siblings().removeClass("active"),s.addClass("active")}},oncreate:function(t){$(t.dom).data("bs.tooltip").tip().addClass(i.deletedAt()?"diffListTooltip deletedDiffTooltip":"diffListTooltip")}}));return[m("li",{className:"Diff ParentDiff"+(i.deletedAt()?" DeletedDiff":""),id:"parentDiff"+i.id()},s),i.deletedAt()?m("li",{className:"Diff SubDiff",id:"subDiff"+i.id()},m(O,{postDate:e.post.createdAt(),subButton:!0,item:i})):""]}))})):"",e.loading?U.a.component({className:"LoadingIndicator--block"}):i.length?"":m("div",{className:"DiffList-empty"},o.a.translator.trans("the-turk-diff.forum.emptyText")))))},i.oncreate=function(e){var i=this;t.prototype.oncreate.call(this,e);var s=this.attrs.state;if(s.forModal&&s.selectedItem){var o=this.$("li#parentDiff"+s.selectedItem);o.find("button").prop("disabled",!0),o.addClass("active")}var n=this.$(".DiffList-content");this.$scrollParent="auto"===n.css("overflow")?n:$(window),this.scrollHandler=function(){var t=i.$scrollParent.scrollTop(),e=i.$scrollParent.height(),o=i.$scrollParent===n?0:n.offset().top,r=n[0].scrollHeight;s.moreResults&&!s.loading&&t+e>=o+r&&s.loadMore()},this.$scrollParent.on("scroll",this.scrollHandler)},i.onremove=function(){this.$scrollParent.off("scroll",this.scrollHandler)},i.toggleSubDiff=function(t){var e=this.$("li.Diff#subDiff"+t),i=this.$("li.Diff#parentDiff"+t).find(".icon");e.toggle(),i.hasClass("fa-caret-down")?i.removeClass("fa-caret-down").addClass("fa-caret-up"):i.removeClass("fa-caret-up").addClass("fa-caret-down")},e}(g.a),q=function(){function t(t,e,i,s){this.post=t,this.forModal=e,this.moreResults=i||!1,this.selectedItem=s,this.loading=!1,app.cache.diffs||(app.cache.diffs=[])}var e=t.prototype;return e.load=function(){if(app.cache.diffs[this.post.id()])return this.redrawList();this.loadMore()},e.loadMore=function(){var t=this;if(this.loading=!0,this.redrawList(),!app.cache.diffs[this.post.id()]||app.cache.diffs[this.post.id()].length!=this.post.revisionCount()){var e=app.cache.diffs[this.post.id()]?{id:this.post.id(),page:{offset:10*app.cache.diffs[this.post.id()].length}}:{id:this.post.id()};return app.store.find("diff",e).then(this.parseResults.bind(this)).catch((function(){})).then((function(){t.loading=!1,t.redrawList()}))}},e.parseResults=function(t){return app.cache.diffs[this.post.id()]=app.cache.diffs[this.post.id()]||[],t.length&&app.cache.diffs[this.post.id()].push(t),this.moreResults=!!t.payload.links.next,t},e.redrawList=function(){if(m.redraw(),!this.forModal)return E(this.post)},t}(),z=function(t){function e(){return t.apply(this,arguments)||this}Object(l.a)(e,t),e.initAttrs=function(e){e.className="DiffDropdown",e.buttonClassName="Button Button--link",e.menuClassName=e.menuClassName,e.label=app.translator.trans("the-turk-diff.forum.editedText"),e.icon="fas fa-history",t.initAttrs.call(this,e)};var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.post=this.attrs.post,this.listState=new q(this.post,!1,null)},i.getButton=function(){var e=t.prototype.getButton.call(this);return e.attrs.title=this.attrs.label,e.attrs.onclick=this.onclick.bind(this),e},i.getButtonContent=function(){return[D()(this.attrs.icon,{className:"Button-icon"}),m("span",{className:"Button-label"},this.attrs.label)]},i.getMenu=function(){var t=this.attrs.post.revisionCount();return m("div",{className:"Dropdown-menu "+this.attrs.menuClassName},m("div",{className:"DiffList-header"},m("h4",null,app.translator.trans("the-turk-diff.forum.revisionInfo",{revisionCount:t}))),this.showing?m(W,{state:this.listState}):"")},i.onclick=function(){this.listState.load()},e}(b.a),J=i(20),G=i.n(J);o.a.initializers.add("the-turk-diff",(function(){o.a.store.models.diff=u,h.a.prototype.revisionCount=f.a.attribute("revisionCount"),h.a.prototype.canViewEditHistory=f.a.attribute("canViewEditHistory"),h.a.prototype.canRollbackEditHistory=f.a.attribute("canRollbackEditHistory"),h.a.prototype.canDeleteEditHistory=f.a.attribute("canDeleteEditHistory"),Object(n.extend)(a.a.prototype,"headerItems",(function(t){var e=this.attrs.post;e.isEdited()&&!e.isHidden()&&e.canViewEditHistory()&&e.revisionCount()>0&&t.replace("edited",z.component({post:e})),this.isEditing()&&o.a.cache.diffs&&o.a.cache.diffs[this.attrs.post.id()]&&delete o.a.cache.diffs[this.attrs.post.id()]})),Object(n.extend)(G.a.prototype,"oninit",(function(){var t=$("body");t.on("click","li.ParentDiff.DeletedDiff",(function(t){t.stopPropagation()})),t.on("click","li.SubDiff",(function(t){t.stopPropagation()}))}))}))}]);
//# sourceMappingURL=forum.js.map