{"version":3,"sources":["webpack://@the-turk/flarum-diff/webpack/bootstrap","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/app']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/Model']\"","webpack://@the-turk/flarum-diff/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@the-turk/flarum-diff/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Button']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/helpers/username']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/helpers/humanTime']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/utils/extractText']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Tooltip']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/models/Post']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Dropdown']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/helpers/avatar']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/helpers/icon']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/extend']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/utils/mixin']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/Component']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Modal']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Alert']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@the-turk/flarum-diff/./src/forum/models/Diff.js","webpack://@the-turk/flarum-diff/./src/forum/components/DiffButton.js","webpack://@the-turk/flarum-diff/./src/forum/utils/redrawPost.js","webpack://@the-turk/flarum-diff/./src/forum/states/DiffListState.js","webpack://@the-turk/flarum-diff/./src/forum/components/DiffModal.js","webpack://@the-turk/flarum-diff/./src/forum/components/DiffList.js","webpack://@the-turk/flarum-diff/./src/forum/components/DiffDropdown.js","webpack://@the-turk/flarum-diff/./src/forum/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_setPrototypeOf","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","constructor","Diff","mixin","Model","revision","attribute","createdAt","transformDate","deletedAt","rollbackedAt","actor","hasOne","deletedUser","rollbackedUser","inlineHtml","sideBySideHtml","combinedHtml","previewHtml","comparisonBetween","DiffButton","view","attrs","assign","this","item","subButton","postDate","type","getButtonContent","buttonText","extractText","app","translator","trans","username","ago","humanTime","avatar","icon","className","title","Button","redrawPost","post","save","then","redraw","DiffListState","forModal","moreResults","selectedItem","loading","cache","diffs","load","id","redrawList","loadMore","length","revisionCount","params","page","offset","store","find","parseResults","results","push","payload","links","next","DiffModal","oninit","vnode","showing","diffId","JSON","parse","listState","href","route","user","config","oncreate","onupdate","$","hasClass","addClass","old","setDiffContent","session","preferences","diffRenderer","component","onclick","hide","canDeleteEditHistory","canRollbackEditHistory","buttonClassName","menuClassName","label","confirm","number","rollbackTo","request","url","forum","method","modal","close","showAlert","content","class","map","switchData","text","state","renderHtml","data","attributes","LoadingIndicator","onready","$revisions","$selectedItem","animate","scrollTop","top","message","success","error","alerts","show","Alert","children","trust","contentType","diffContentHtml","$diffContainer","$previewContainer","$sideBySideButton","$inlineButton","$combinedButton","$previewButton","prop","parent","siblings","setInfoContent","html","is","savePreferences","preview","$infoContainer","infoContentHtml","new","Modal","DiffList","pages","diffButton","position","toggleSubDiff","$listContainer","removeClass","dom","tip","tooltipClass","$scrollParent","css","window","scrollHandler","viewportHeight","height","contentTop","contentHeight","scrollHeight","on","onremove","off","$subDiff","$icon","toggle","Component","DiffDropdown","initAttrs","getButton","vdom","getMenu","Dropdown","initializers","add","models","diff","Post","canViewEditHistory","extend","CommentPost","items","isEdited","isHidden","replace","isEditing","DiscussionPage","$body","e","stopPropagation"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 23);\n","module.exports = flarum.core.compat['common/app'];","module.exports = flarum.core.compat['common/Model'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/helpers/username'];","module.exports = flarum.core.compat['common/helpers/humanTime'];","module.exports = flarum.core.compat['common/utils/extractText'];","module.exports = flarum.core.compat['common/components/Tooltip'];","module.exports = flarum.core.compat['common/models/Post'];","module.exports = flarum.core.compat['common/components/Dropdown'];","module.exports = flarum.core.compat['common/helpers/avatar'];","module.exports = flarum.core.compat['common/helpers/icon'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['forum/components/CommentPost'];","module.exports = flarum.core.compat['common/utils/mixin'];","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/components/Modal'];","module.exports = flarum.core.compat['common/components/Alert'];","module.exports = flarum.core.compat['forum/components/DiscussionPage'];","import Model from 'flarum/common/Model';\r\nimport mixin from 'flarum/common/utils/mixin';\r\n\r\nexport default class Diff extends mixin(Model, {\r\n  revision: Model.attribute('revision'),\r\n  createdAt: Model.attribute('createdAt', Model.transformDate),\r\n  deletedAt: Model.attribute('deletedAt', Model.transformDate),\r\n  rollbackedAt: Model.attribute('rollbackedAt', Model.transformDate),\r\n  actor: Model.hasOne('actor'),\r\n  deletedUser: Model.hasOne('deletedUser'),\r\n  rollbackedUser: Model.hasOne('rollbackedUser'),\r\n  inlineHtml: Model.attribute('inlineHtml'),\r\n  sideBySideHtml: Model.attribute('sideBySideHtml'),\r\n  combinedHtml: Model.attribute('combinedHtml'),\r\n  previewHtml: Model.attribute('previewHtml'),\r\n  comparisonBetween: Model.attribute('comparisonBetween'),\r\n}) {}\r\n","import Button from 'flarum/common/components/Button';\r\nimport avatar from 'flarum/common/helpers/avatar';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport username from 'flarum/common/helpers/username';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport extractText from 'flarum/common/utils/extractText';\r\n\r\n/**\r\n * The `DiffButton` component composes a button\r\n * for all revisions created in DiffList.\r\n */\r\nexport default class DiffButton extends Button {\r\n  // see the following link to find out why i'm overriding this at all\r\n  // https://discuss.flarum.org/d/22728-passing-an-object-to-a-custom-button-component\r\n  view() {\r\n    const attrs = Object.assign({}, this.attrs);\r\n\r\n    delete attrs.item;\r\n    delete attrs.subButton;\r\n    delete attrs.postDate;\r\n\r\n    attrs.type = 'button';\r\n\r\n    return <button {...attrs}>{this.getButtonContent()}</button>;\r\n  }\r\n\r\n  getButtonContent() {\r\n    const revision = this.attrs.item;\r\n    let actor = revision.actor();\r\n\r\n    let buttonText =\r\n      revision.revision() == 0\r\n        ? /* {username} created {ago} */\r\n          extractText(\r\n            app.translator.trans('the-turk-diff.forum.createdInfo', {\r\n              username: username(revision.actor()),\r\n              ago: humanTime(this.attrs.postDate),\r\n            })\r\n          )\r\n        : /* {username} edited {ago} */\r\n          extractText(\r\n            app.translator.trans('the-turk-diff.forum.editedInfo', {\r\n              username: username(revision.actor()),\r\n              ago: humanTime(revision.createdAt()),\r\n            })\r\n          );\r\n\r\n    if (revision.deletedAt()) {\r\n      if (this.attrs.subButton === false) {\r\n        /* {username} did something {ago} (deleted) */\r\n        buttonText = buttonText + ' ' + app.translator.trans('the-turk-diff.forum.deletedText');\r\n      } else {\r\n        /* sub button text that appears when you click on caret icon */\r\n        actor = revision.deletedUser();\r\n        /* {actor} deleted this content {ago} */\r\n        buttonText = extractText(\r\n          app.translator.trans('the-turk-diff.forum.deletedInfo', {\r\n            username: username(revision.deletedUser()),\r\n            ago: humanTime(revision.deletedAt()),\r\n          })\r\n        );\r\n      }\r\n    }\r\n\r\n    return [\r\n      // we also should consider deleted users here\r\n      actor.username() ? avatar(actor) : '',\r\n      // does this button have an icon?\r\n      revision.deletedAt() && this.attrs.subButton === false\r\n        ? icon('fas fa-caret-down', {\r\n            className: 'Button-caret',\r\n          })\r\n        : '',\r\n      // button label\r\n      <span className=\"Button-label\" title={buttonText}>\r\n        {revision.deletedAt() && this.attrs.subButton === true ? (\r\n          /* emphasize deleted revision's information */\r\n          <em>{buttonText}</em>\r\n        ) : (\r\n          buttonText\r\n        )}\r\n      </span>,\r\n    ];\r\n  }\r\n}\r\n","/**\r\n * Redraw the post.\r\n * Workaround for - SubtreeRetainer doesn't allow redrawing post\r\n * https://discuss.flarum.org/d/22755-mithril-related-issues-on-poststream-items\r\n *\r\n * @param {Object} post\r\n */\r\nexport default function redrawPost(post) {\r\n  return post.save({}).then(() => m.redraw());\r\n}\r\n","import redrawPost from '../utils/redrawPost';\r\n\r\nexport default class DiffListState {\r\n  constructor(post, forModal, moreResults, selectedItem) {\r\n    this.post = post;\r\n    this.forModal = forModal;\r\n    this.moreResults = moreResults || false;\r\n    this.selectedItem = selectedItem;\r\n    this.loading = false;\r\n\r\n    if (!app.cache.diffs) {\r\n      app.cache.diffs = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load revisions.\r\n   *\r\n   * @public\r\n   */\r\n  load() {\r\n    // don't do anthing if we already cached revisions for the post.\r\n    // lazy-loading will perform loadMore() if there are moreResults\r\n    if (app.cache.diffs[this.post.id()]) return this.redrawList();\r\n\r\n    this.loadMore();\r\n  }\r\n\r\n  /**\r\n   * Load the next page of revision results.\r\n   *\r\n   * @public\r\n   */\r\n  loadMore() {\r\n    this.loading = true;\r\n    this.redrawList();\r\n\r\n    // don't do anthing if we already cached ALL revisions for the post.\r\n    if (app.cache.diffs[this.post.id()] && app.cache.diffs[this.post.id()].length == this.post.revisionCount()) {\r\n      return;\r\n    }\r\n\r\n    // set URL parameters\r\n    const params = app.cache.diffs[this.post.id()]\r\n      ? {\r\n          id: this.post.id(),\r\n          page: {\r\n            offset: app.cache.diffs[this.post.id()].length * 10,\r\n          },\r\n        }\r\n      : {\r\n          id: this.post.id(),\r\n        };\r\n\r\n    return app.store\r\n      .find('diff', params)\r\n      .then(this.parseResults.bind(this))\r\n      .catch(() => {})\r\n      .then(() => {\r\n        this.loading = false;\r\n        this.redrawList();\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Parse results and append them to the revision list.\r\n   *\r\n   * @param {Diff[]} results\r\n   * @return {Diff[]}\r\n   */\r\n  parseResults(results) {\r\n    app.cache.diffs[this.post.id()] = app.cache.diffs[this.post.id()] || [];\r\n\r\n    if (results.length) app.cache.diffs[this.post.id()].push(results);\r\n\r\n    this.moreResults = !!results.payload.links.next;\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Redraw the list based on parent component.\r\n   */\r\n  redrawList() {\r\n    m.redraw();\r\n\r\n    // because we don't need to redraw the post\r\n    // to update DiffList in DiffModal.\r\n    // We just need it for updating DiffDropdown.\r\n    if (this.forModal) return;\r\n\r\n    return redrawPost(this.post);\r\n  }\r\n}\r\n","import app from 'flarum/common/app';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Tooltip from 'flarum/common/components/Tooltip';\r\nimport username from 'flarum/common/helpers/username';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport avatar from 'flarum/common/helpers/avatar';\r\nimport extractText from 'flarum/common/utils/extractText';\r\nimport touchDevice from '../utils/touchDevice';\r\nimport redrawPost from '../utils/redrawPost';\r\nimport Alert from 'flarum/common/components/Alert';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Dropdown from 'flarum/common/components/Dropdown';\r\nimport DiffList from './DiffList';\r\nimport DiffListState from '../states/DiffListState';\r\n\r\n/**\r\n * The `DiffModal` component is the main component of this extension.\r\n * It also contains DiffList components.\r\n */\r\nexport default class DiffModal extends Modal {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    /**\r\n     * Whether or not the modal is loading.\r\n     *\r\n     * @type {Boolean}\r\n     */\r\n    this.loading = false;\r\n\r\n    /**\r\n     * Whether the modal is showing or not.\r\n     *\r\n     * @type {Boolean}\r\n     */\r\n    this.showing = false;\r\n\r\n    /**\r\n     * We will use this to change modal's content when\r\n     * user clicks on a revision on the list.\r\n     *\r\n     * @type {Number|Null}\r\n     */\r\n    this.diffId = null;\r\n\r\n    /**\r\n     * This holds information about which revisions are subjects for comparison.\r\n     *\r\n     * @type {Object}\r\n     */\r\n    this.comparisonBetween = JSON.parse(this.attrs.listState.selectedItem.comparisonBetween());\r\n  }\r\n\r\n  className() {\r\n    return 'DiffModal';\r\n  }\r\n\r\n  title() {\r\n    return [\r\n      // we also should consider deleted users here\r\n      this.attrs.listState.selectedItem.actor().username() ? avatar(this.attrs.listState.selectedItem.actor()) : '',\r\n      this.attrs.listState.selectedItem.revision() != 0\r\n        ? // x edited y ago\r\n          app.translator.trans('the-turk-diff.forum.editedInfo', {\r\n            username: (\r\n              <a href={app.route.user(this.attrs.listState.selectedItem.actor())} config={m.route}>\r\n                {username(this.attrs.listState.selectedItem.actor())}\r\n              </a>\r\n            ),\r\n            ago: humanTime(this.attrs.listState.selectedItem.createdAt()),\r\n          })\r\n        : // x created y ago\r\n          app.translator.trans('the-turk-diff.forum.createdInfo', {\r\n            username: (\r\n              <a href={app.route.user(this.attrs.listState.selectedItem.actor())} config={m.route}>\r\n                {username(this.attrs.listState.selectedItem.actor())}\r\n              </a>\r\n            ),\r\n            ago: humanTime(this.attrs.listState.post.createdAt()),\r\n          }),\r\n    ];\r\n  }\r\n\r\n  oncreate(vnode) {\r\n    super.oncreate(vnode);\r\n\r\n    this.config(vnode);\r\n  }\r\n\r\n  onupdate(vnode) {\r\n    this.config(vnode);\r\n  }\r\n\r\n  config(vnode) {\r\n    // workaround for missing 'in' class on .ModalManager\r\n    // after redrawing the DiffList component.\r\n    // because i'm done with this shit.\r\n    // https://github.com/flarum/core/pull/2080\r\n    if (this.showing && !$('.ModalManager').hasClass('in')) $('.ModalManager').addClass('in');\r\n\r\n    // we should re-Initialize this component after user\r\n    // clicks a different revision while modal is open\r\n    if (this.diffId === this.attrs.listState.selectedItem.id()) return;\r\n\r\n    this.showing = true;\r\n    this.diffId = this.attrs.listState.selectedItem.id();\r\n\r\n    this.comparisonBetween = JSON.parse(this.attrs.listState.selectedItem.comparisonBetween());\r\n\r\n    if (this.attrs.listState.selectedItem.revision() != 0 && this.comparisonBetween.new.revision != this.comparisonBetween.old.revision) {\r\n      // we'll use Side By Side renderer as a fallback\r\n      // if there is no renderer choice\r\n      return this.setDiffContent(app.session.user.preferences().diffRenderer ? app.session.user.preferences().diffRenderer : 'sideBySide');\r\n    } else {\r\n      return this.setDiffContent('preview');\r\n    }\r\n  }\r\n\r\n  view() {\r\n    return (\r\n      <div className={'Modal modal-dialog ' + this.className()}>\r\n        <div className=\"Modal-content\">\r\n          <div className=\"Modal-close App-backControl\">\r\n            {Button.component({\r\n              icon: 'fas fa-times',\r\n              onclick: this.hide.bind(this),\r\n              className: 'Button Button--icon Button--link',\r\n            })}\r\n          </div>\r\n          {\r\n            // Revision Options Button\r\n          }\r\n          {(this.attrs.listState.post.canDeleteEditHistory() &&\r\n            this.attrs.listState.selectedItem.revision() != this.attrs.listState.post.revisionCount()) ||\r\n          (this.attrs.listState.post.canRollbackEditHistory() && this.$('.DeletedDiff').length != this.attrs.listState.post.revisionCount()) ? (\r\n            <Dropdown\r\n              className=\"diffCotrollerDropdown App-primaryControl\"\r\n              icon=\"fas fa-ellipsis-v\"\r\n              buttonClassName=\"Button\"\r\n              menuClassName=\"Dropdown-menu--right\"\r\n              label={app.translator.trans('the-turk-diff.forum.optionsButton')}\r\n            >\r\n              {\r\n                // Rollback\r\n                // there must be a revision to rollback,\r\n                // as we can't rollback to current post.\r\n              }\r\n              {this.attrs.listState.post.canRollbackEditHistory() && this.comparisonBetween.old.diffId\r\n                ? Button.component(\r\n                    {\r\n                      icon: 'fas fa-reply',\r\n                      onclick: () => {\r\n                        if (\r\n                          confirm(\r\n                            app.translator.trans('the-turk-diff.forum.confirmRollback', {\r\n                              number: this.attrs.listState.selectedItem.revision(),\r\n                            })\r\n                          )\r\n                        ) {\r\n                          this.loading = true;\r\n                          m.redraw();\r\n\r\n                          let rollbackTo =\r\n                            this.attrs.listState.selectedItem.revision() == this.attrs.listState.post.revisionCount()\r\n                              ? this.comparisonBetween.old.diffId\r\n                              : this.attrs.listState.selectedItem.id();\r\n\r\n                          app\r\n                            .request({\r\n                              url: `${app.forum.attribute('apiUrl')}/diff/${rollbackTo}`,\r\n                              method: 'POST',\r\n                            })\r\n                            .then(() => {\r\n                              redrawPost(this.attrs.listState.post);\r\n                              app.modal.close();\r\n\r\n                              if (app.cache.diffs && app.cache.diffs[this.attrs.listState.post.id()]) {\r\n                                delete app.cache.diffs[this.attrs.listState.post.id()];\r\n                              }\r\n\r\n                              this.showAlert('success', 'rollback');\r\n                            })\r\n                            .catch(() => {\r\n                              this.loading = false;\r\n                              m.redraw();\r\n                              redrawPost(this.attrs.listState.post);\r\n\r\n                              this.showAlert('error', 'rollback');\r\n                            });\r\n                        }\r\n                      },\r\n                    },\r\n                    this.attrs.listState.selectedItem.revision() == 0\r\n                      ? /* we're viewing the original content */\r\n                        app.translator.trans('the-turk-diff.forum.rollbackToOriginalButton')\r\n                      : this.attrs.listState.selectedItem.revision() == this.attrs.listState.post.revisionCount()\r\n                      ? this.comparisonBetween.old.revision != 0\r\n                        ? /* we're comparing this revision with current content. */\r\n                          app.translator.trans('the-turk-diff.forum.revertChangesButton')\r\n                        : /* we're comparing this revision with original content */\r\n                          app.translator.trans('the-turk-diff.forum.rollbackToOriginalButton')\r\n                      : /* we're comparing this revision with another revision */\r\n                        app.translator.trans('the-turk-diff.forum.rollbackButton', {\r\n                          number: this.attrs.listState.selectedItem.revision(),\r\n                        })\r\n                  )\r\n                : ''}\r\n\r\n              {\r\n                // Delete\r\n                // you can't delete last item on the list\r\n                // because it's the current post actually.\r\n              }\r\n              {this.attrs.listState.post.canDeleteEditHistory() &&\r\n              this.attrs.listState.selectedItem.revision() != this.attrs.listState.post.revisionCount()\r\n                ? Button.component(\r\n                    {\r\n                      icon: 'far fa-trash-alt',\r\n                      onclick: () => {\r\n                        if (confirm(app.translator.trans('the-turk-diff.forum.confirmDelete'))) {\r\n                          this.loading = true;\r\n                          m.redraw();\r\n\r\n                          this.attrs.listState.selectedItem\r\n                            .delete()\r\n                            .then(() => {\r\n                              app.modal.close();\r\n\r\n                              if (app.cache.diffs && app.cache.diffs[this.attrs.listState.post.id()]) {\r\n                                delete app.cache.diffs[this.attrs.listState.post.id()];\r\n                              }\r\n\r\n                              this.showAlert('success', 'delete');\r\n                            })\r\n                            .catch(() => {\r\n                              this.loading = false;\r\n                              m.redraw();\r\n\r\n                              this.showAlert('error', 'delete');\r\n                            });\r\n                        }\r\n                      },\r\n                    },\r\n                    app.translator.trans('the-turk-diff.forum.deleteButton')\r\n                  )\r\n                : ''}\r\n            </Dropdown>\r\n          ) : (\r\n            ''\r\n          )}\r\n\r\n          <div className=\"Modal-header\">\r\n            <h3 className=\"App-titleControl App-titleControl--text\">{this.title()}</h3>\r\n          </div>\r\n          {this.content()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  content() {\r\n    // we can use this class to customize all tooltips\r\n    // provided by this extension\r\n    const tooltipClass = 'diffTooltip';\r\n    const revisionCount = this.attrs.listState.post.revisionCount();\r\n\r\n    /**\r\n     * `type` is passed to `setDiffContent` and the tooltip.\r\n     */\r\n    const diffSwitches = [\r\n      {\r\n        type: 'inline',\r\n        icon: 'fas fa-grip-lines',\r\n        class: 'inlineView',\r\n      },\r\n      {\r\n        type: 'sideBySide',\r\n        icon: 'fas fa-columns',\r\n        class: 'sideBySideView',\r\n      },\r\n      {\r\n        type: 'combined',\r\n        icon: 'far fa-square',\r\n        class: 'combinedView',\r\n      },\r\n    ];\r\n\r\n    return [\r\n      <div className=\"diff-grid\">\r\n        {/* Renderer Switcher Container */}\r\n        <div className=\"diff-grid-item diff-grid-controls\">\r\n          <div className=\"diffSwitcher\">\r\n            {this.attrs.listState.selectedItem.revision() != 0 && this.comparisonBetween.new.revision != this.comparisonBetween.old.revision\r\n              ? diffSwitches.map((switchData) => (\r\n                  <Tooltip text={app.translator.trans(`the-turk-diff.forum.tooltips.${switchData.type}`)}>\r\n                    <div className=\"tooltip-wrapper\">\r\n                      <Button\r\n                        icon={switchData.icon}\r\n                        onclick={() => this.setDiffContent(switchData.type)}\r\n                        className={`Button Button--icon Button--link ${switchData.class}`}\r\n                      />\r\n                    </div>\r\n                  </Tooltip>\r\n                ))\r\n              : ''}\r\n            <Tooltip text={app.translator.trans('the-turk-diff.forum.tooltips.preview')}>\r\n              <div className=\"tooltip-wrapper\">\r\n                <Button icon=\"far fa-eye\" onclick={() => this.setDiffContent('preview')} className=\"Button Button--icon Button--link diffPreview\" />\r\n              </div>\r\n            </Tooltip>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Comparison Info Container */}\r\n        <div className=\"diff-grid-item diff-grid-info\">\r\n          <div className=\"revisionInfo\">\r\n            <h4>{app.translator.trans('the-turk-diff.forum.revisions', { revisionCount })}</h4>\r\n            <p class=\"diffInfoContainer\" />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Revision List Container */}\r\n        <div className=\"diff-grid-item diff-grid-revisions\">\r\n          <DiffList state={this.attrs.listState}></DiffList>\r\n        </div>\r\n\r\n        {/* Diffs Container */}\r\n        <div className=\"diff-grid-item diff-grid-diff\">\r\n          <div className=\"diffContents\">\r\n            {\r\n              // .previewContainer is hidden by default\r\n              // we'll do some nasty switches later\r\n            }\r\n            <div\r\n              className={\r\n                'previewContainer Post-body' + (app.forum.attribute('textFormattingForDiffPreviews') === false ? ' diff-skip-formatting' : '')\r\n              }\r\n            >\r\n              {this.renderHtml(this.attrs.listState.selectedItem.data.attributes.previewHtml)}\r\n            </div>\r\n            <div className=\"diffContainer\" />\r\n          </div>\r\n        </div>\r\n        {LoadingIndicator.component({\r\n          className: 'DiffModal-loading' + (this.loading ? ' active' : ''),\r\n        })}\r\n      </div>,\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Slowly scroll to selected revision.\r\n   */\r\n  onready() {\r\n    const $revisions = this.$('.DiffList-content');\r\n    let $selectedItem = this.$('li#parentDiff' + this.attrs.listState.selectedItem.id());\r\n\r\n    $revisions.animate({\r\n      scrollTop: $selectedItem.offset().top - $revisions.offset().top + $revisions.scrollTop(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show success and error messages for rollback and delete operations.\r\n   *\r\n   * @param {string} type\r\n   * @param {string} key\r\n   */\r\n  showAlert(type, key) {\r\n    const message = {\r\n      success: 'the-turk-diff.forum.' + key + 'SuccessMessage',\r\n      error: 'the-turk-diff.forum.' + key + 'ErrorMessage',\r\n    }[type];\r\n\r\n    app.alerts.show(Alert, {\r\n      type,\r\n      children: app.translator.trans(message),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Render the diff views provided by external lib.\r\n   *\r\n   * do we need to worry about m.trust() function?\r\n   * well, Flarum itself doing the same way for rendering\r\n   * post items as seen on CommentPost.js#L52\r\n   * also, the diff library itself treat all inputs as plain text:\r\n   * https://github.com/jfcherng/php-diff/issues/9#issuecomment-526808774\r\n   * so no need to use additional Sanitizer lib for this operation.\r\n   *\r\n   * @param {string} content\r\n   */\r\n  renderHtml(content) {\r\n    return m.trust(content);\r\n  }\r\n\r\n  /**\r\n   * Insert rendered diff views into their container\r\n   * and disable active views' buttons.\r\n   * Disabling buttons is just for indicating\r\n   * so frontend looks good but the backend sucks.\r\n   *\r\n   * @param {string} contentType\r\n   */\r\n  setDiffContent(contentType) {\r\n    let diffContentHtml;\r\n    const $diffContainer = this.$('.diffContainer');\r\n    const $previewContainer = this.$('.previewContainer');\r\n    const $tooltip = this.$('.diffTooltip');\r\n\r\n    // buttons\r\n    const $sideBySideButton = this.$('.Button.sideBySideView');\r\n    const $inlineButton = this.$('.Button.inlineView');\r\n    const $combinedButton = this.$('.Button.combinedView');\r\n    const $previewButton = this.$('.Button.diffPreview');\r\n\r\n    if (contentType !== 'preview') {\r\n      if (contentType === 'sideBySide') {\r\n        diffContentHtml = this.renderHtml(this.attrs.listState.selectedItem.data.attributes.sideBySideHtml);\r\n        $sideBySideButton.prop('disabled', true);\r\n        // what a dynasty - LOL\r\n        $sideBySideButton.parent().siblings().children().prop('disabled', false);\r\n      } else if (contentType === 'inline') {\r\n        diffContentHtml = this.renderHtml(this.attrs.listState.selectedItem.data.attributes.inlineHtml);\r\n        $inlineButton.prop('disabled', true);\r\n        $inlineButton.parent().siblings().children().prop('disabled', false);\r\n      } else if (contentType === 'combined') {\r\n        diffContentHtml = this.renderHtml(this.attrs.listState.selectedItem.data.attributes.combinedHtml);\r\n        $combinedButton.prop('disabled', true);\r\n        $combinedButton.parent().siblings().children().prop('disabled', false);\r\n      }\r\n    } else {\r\n      $diffContainer.hide();\r\n      this.$('.previewContainer').show();\r\n\r\n      $previewButton.prop('disabled', true);\r\n      $previewButton.parent().siblings().children().prop('disabled', false);\r\n      return this.setInfoContent(true);\r\n    }\r\n\r\n    if (diffContentHtml) {\r\n      $diffContainer.html(diffContentHtml.children);\r\n\r\n      if ($previewContainer.is(':visible')) {\r\n        $diffContainer.show();\r\n        $previewContainer.hide();\r\n      }\r\n\r\n      // let's remember their renderer choice\r\n      app.session.user.savePreferences({\r\n        diffRenderer: contentType,\r\n      });\r\n\r\n      return this.setInfoContent();\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Set informations about comparisons.\r\n   *\r\n   * @param {Boolean} preview\r\n   */\r\n  setInfoContent(preview = false) {\r\n    const $infoContainer = this.$('.diffInfoContainer');\r\n\r\n    let infoContentHtml =\r\n      !preview && this.attrs.listState.selectedItem.revision() != 0 && this.comparisonBetween.new.revision != this.comparisonBetween.old.revision\r\n        ? extractText(\r\n            app.translator.trans('the-turk-diff.forum.differences.sentence', {\r\n              old:\r\n                this.comparisonBetween.old.revision == -1\r\n                  ? /* we're viewing differences between current content and {new} */\r\n                    app.translator.trans('the-turk-diff.forum.differences.currentContent')\r\n                  : this.comparisonBetween.old.revision == 0\r\n                  ? /* we're viewing differences between original content and {new} */\r\n                    app.translator.trans('the-turk-diff.forum.differences.originalContent')\r\n                  : /* we're viewing differences between revision X and {new} */\r\n                    app.translator.trans('the-turk-diff.forum.differences.revisionWithNumber', {\r\n                      number: this.comparisonBetween.old.revision,\r\n                    }),\r\n              new:\r\n                this.comparisonBetween.new.revision == 0\r\n                  ? /* we're viewing differences between {old} and original content */\r\n                    app.translator.trans('the-turk-diff.forum.differences.originalContent')\r\n                  : this.comparisonBetween.new.revision == this.attrs.listState.post.revisionCount()\r\n                  ? /* we're viewing differences between {old} and current content */\r\n                    app.translator.trans('the-turk-diff.forum.differences.currentContent')\r\n                  : /* we're viewing differences between {old} and revision X */\r\n                    app.translator.trans('the-turk-diff.forum.differences.revisionWithNumber', {\r\n                      number: this.comparisonBetween.new.revision,\r\n                    }),\r\n            })\r\n          )\r\n        : extractText(\r\n            app.translator.trans('the-turk-diff.forum.previewMode.sentence', {\r\n              content:\r\n                this.comparisonBetween.new.revision == 0\r\n                  ? /* we're previewing original content */\r\n                    app.translator.trans('the-turk-diff.forum.previewMode.originalContent')\r\n                  : this.comparisonBetween.new.revision == this.attrs.listState.post.revisionCount()\r\n                  ? /* we're previewing current content */\r\n                    app.translator.trans('the-turk-diff.forum.previewMode.currentContent')\r\n                  : /* we're previewing revision X */\r\n                    app.translator.trans('the-turk-diff.forum.previewMode.revisionWithNumber', {\r\n                      number: this.comparisonBetween.new.revision,\r\n                    }),\r\n            })\r\n          );\r\n\r\n    return $infoContainer.html(infoContentHtml);\r\n  }\r\n}\r\n","import app from 'flarum/common/app';\r\nimport Component from 'flarum/common/Component';\r\nimport DiffButton from './DiffButton';\r\nimport DiffModal from './DiffModal';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Tooltip from 'flarum/common/components/Tooltip';\r\n\r\n/**\r\n * The `DiffList` component displays a list of the post's revisions.\r\n * It's been using on both DiffDropdown & DiffModal components.\r\n * It also contains DiffButton components.\r\n */\r\nexport default class DiffList extends Component {\r\n  view() {\r\n    const state = this.attrs.state;\r\n    const pages = app.cache.diffs[state.post.id()] || [];\r\n\r\n    return (\r\n      <div className=\"DiffList-container\">\r\n        <div className=\"DiffList-content\">\r\n          <ul>\r\n            {pages.length\r\n              ? pages.map((diffs) => {\r\n                  return diffs.map((item) => {\r\n                    // we can use this class to customize all tooltips\r\n                    // provided by this extension\r\n                    const tooltipClass = 'diffTooltip';\r\n\r\n                    let diffButton = (\r\n                      <Tooltip\r\n                        position=\"left\"\r\n                        text={\r\n                          item.revision() == state.post.revisionCount()\r\n                            ? // we're hovering on latest revision's button\r\n                              app.translator.trans('the-turk-diff.forum.tooltips.mostRecent')\r\n                            : item.revision() == 0\r\n                            ? // we're hovering on zeroth revision's button\r\n                              app.translator.trans('the-turk-diff.forum.tooltips.originalContent')\r\n                            : // we're hovering on other revision's button\r\n                              app.translator.trans('the-turk-diff.forum.tooltips.revisionWithNumber', {\r\n                                number: item.revision(),\r\n                              })\r\n                        }\r\n                      >\r\n                        {DiffButton.component({\r\n                          'data-container': 'body',\r\n                          postDate: state.post.createdAt(),\r\n                          subButton: false,\r\n                          item,\r\n                          onclick: () => {\r\n                            if (!item.deletedAt()) {\r\n                              state.selectedItem = item;\r\n                              app.modal.show(DiffModal, { listState: state });\r\n\r\n                              if (state.forModal) {\r\n                                // .DiffList-content container of clicked revision\r\n                                const $listContainer = this.$('li#parentDiff' + item.id());\r\n\r\n                                // disable clicked revision, enable others\r\n                                $listContainer.find('button').prop('disabled', true);\r\n                                $listContainer.siblings().find('button').prop('disabled', false);\r\n                                // add 'active' class to clicked revision, remove it from others\r\n                                $listContainer.siblings().removeClass('active');\r\n                                $listContainer.addClass('active');\r\n                              }\r\n                            } else {\r\n                              // if revision is deleted, we'll toggle the info\r\n                              // like GitHub does.\r\n                              this.toggleSubDiff(item.id());\r\n                            }\r\n                          },\r\n                          oncreate: (vnode) => {\r\n                            $(vnode.dom)\r\n                              // this is a workaround for adding custom\r\n                              // classes into bootstrap tooltips\r\n                              // https://stackoverflow.com/a/29879041/12866913\r\n                              .data('bs.tooltip')\r\n                              .tip()\r\n                              .addClass(item.deletedAt() ? tooltipClass + ' deletedDiffTooltip' : tooltipClass);\r\n                          },\r\n                        })}\r\n                      </Tooltip>\r\n                    );\r\n\r\n                    // returns the template for revision list items\r\n                    return [\r\n                      <li className={'Diff ParentDiff' + (item.deletedAt() ? ' DeletedDiff' : '')} id={'parentDiff' + item.id()}>\r\n                        {diffButton}\r\n                      </li>,\r\n                      item.deletedAt() ? (\r\n                        <li className=\"Diff SubDiff\" id={'subDiff' + item.id()}>\r\n                          <DiffButton postDate={state.post.createdAt()} subButton item={item} />\r\n                        </li>\r\n                      ) : (\r\n                        ''\r\n                      ),\r\n                    ];\r\n                  });\r\n                })\r\n              : ''}\r\n            {state.loading ? (\r\n              LoadingIndicator.component({\r\n                className: 'LoadingIndicator--block',\r\n              })\r\n            ) : !pages.length ? (\r\n              <div className=\"DiffList-empty\">{app.translator.trans('the-turk-diff.forum.emptyText')}</div>\r\n            ) : (\r\n              ''\r\n            )}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  oncreate(vnode) {\r\n    super.oncreate(vnode);\r\n    const state = this.attrs.state;\r\n\r\n    if (state.forModal && state.selectedItem) {\r\n      let $selectedItem = this.$('li#parentDiff' + state.selectedItem);\r\n      $selectedItem.find('button').prop('disabled', true);\r\n      $selectedItem.addClass('active');\r\n    }\r\n\r\n    const $revisions = this.$('.DiffList-content');\r\n    this.$scrollParent = $revisions.css('overflow') === 'auto' ? $revisions : $(window);\r\n\r\n    // Lazy-loading implementation for the revision list\r\n    // simply checks if we're bottom of the list\r\n    // and if there are more results to show\r\n    this.scrollHandler = () => {\r\n      const scrollTop = $scrollParent.scrollTop();\r\n      const viewportHeight = $scrollParent.height();\r\n      const contentTop = $scrollParent === $revisions ? 0 : $revisions.offset().top;\r\n      const contentHeight = $revisions[0].scrollHeight;\r\n\r\n      if (state.moreResults && !state.loading && scrollTop + viewportHeight >= contentTop + contentHeight) {\r\n        state.loadMore();\r\n      }\r\n    };\r\n\r\n    this.$scrollParent.on('scroll', this.scrollHandler);\r\n  }\r\n\r\n  onremove(vnode) {\r\n    this.$scrollParent.off('scroll', this.scrollHandler);\r\n  }\r\n\r\n  /**\r\n   * Toggle the deleted revision's information (sub-button).\r\n   *\r\n   * @param {Number} id\r\n   */\r\n  toggleSubDiff(id) {\r\n    const $subDiff = this.$('li.Diff#subDiff' + id);\r\n    const $parentDiff = this.$('li.Diff#parentDiff' + id);\r\n    const $icon = $parentDiff.find('.icon');\r\n\r\n    $subDiff.toggle();\r\n\r\n    // switch caret icon onClick\r\n    if ($icon.hasClass('fa-caret-down')) {\r\n      $icon.removeClass('fa-caret-down').addClass('fa-caret-up');\r\n    } else {\r\n      $icon.removeClass('fa-caret-up').addClass('fa-caret-down');\r\n    }\r\n  }\r\n}\r\n","import Dropdown from 'flarum/common/components/Dropdown';\r\nimport DiffList from './DiffList';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport DiffListState from '../states/DiffListState';\r\n\r\n/**\r\n * The `DiffDropdown` component is the entrance point for this extension.\r\n * It's the component that you see when you click on \"Edited\" button.\r\n * It also contains DiffList components.\r\n */\r\nexport default class DiffDropdown extends Dropdown {\r\n  static initAttrs(attrs) {\r\n    attrs.className = 'DiffDropdown';\r\n    attrs.buttonClassName = 'Button Button--link';\r\n    attrs.menuClassName = attrs.menuClassName;\r\n    attrs.label = app.translator.trans('the-turk-diff.forum.editedText');\r\n    attrs.icon = 'fas fa-history';\r\n\r\n    super.initAttrs(attrs);\r\n  }\r\n\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    /**\r\n     * The post that we're working with.\r\n     *\r\n     * @type {Post[]}\r\n     */\r\n    this.post = this.attrs.post;\r\n\r\n    /**\r\n     * Create a new revision list.\r\n     *\r\n     * @type {DiffListState}\r\n     */\r\n    this.listState = new DiffListState(this.post, false, null);\r\n  }\r\n\r\n  getButton() {\r\n    const vdom = super.getButton();\r\n\r\n    vdom.attrs.title = this.attrs.label;\r\n    vdom.attrs.onclick = this.onclick.bind(this);\r\n\r\n    return vdom;\r\n  }\r\n\r\n  getButtonContent() {\r\n    return [\r\n      icon(this.attrs.icon, {\r\n        className: 'Button-icon',\r\n      }),\r\n      <span className=\"Button-label\">{this.attrs.label}</span>,\r\n    ];\r\n  }\r\n\r\n  getMenu() {\r\n    const revisionCount = this.attrs.post.revisionCount();\r\n\r\n    return (\r\n      <div className={'Dropdown-menu ' + this.attrs.menuClassName}>\r\n        <div className=\"DiffList-header\">\r\n          <h4>\r\n            {/* edited 1 time | edited x times */}\r\n            {app.translator.trans('the-turk-diff.forum.revisionInfo', { revisionCount })}\r\n          </h4>\r\n        </div>\r\n        {this.showing ? <DiffList state={this.listState}></DiffList> : ''}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Load revision list.\r\n   */\r\n  onclick() {\r\n    this.listState.load();\r\n  }\r\n}\r\n","import app from 'flarum/common/app';\r\nimport { extend } from 'flarum/common/extend';\r\nimport CommentPost from 'flarum/forum/components/CommentPost';\r\nimport Diff from './models/Diff';\r\nimport Post from 'flarum/common/models/Post';\r\nimport Model from 'flarum/common/Model';\r\nimport DiffDropdown from './components/DiffDropdown';\r\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\r\n\r\napp.initializers.add('the-turk-diff', () => {\r\n  app.store.models.diff = Diff;\r\n  Post.prototype.revisionCount = Model.attribute('revisionCount');\r\n  Post.prototype.canViewEditHistory = Model.attribute('canViewEditHistory');\r\n  Post.prototype.canRollbackEditHistory = Model.attribute('canRollbackEditHistory');\r\n  Post.prototype.canDeleteEditHistory = Model.attribute('canDeleteEditHistory');\r\n\r\n  extend(CommentPost.prototype, 'headerItems', function (items) {\r\n    const post = this.attrs.post;\r\n\r\n    // replace \"edited\" text to \"edited\" button\r\n    if (post.isEdited() && !post.isHidden() && post.canViewEditHistory() && post.revisionCount() > 0) {\r\n      items.replace('edited', DiffDropdown.component({ post }));\r\n    }\r\n\r\n    // remove diffs cache when post is editing\r\n    if (this.isEditing() && app.cache.diffs && app.cache.diffs[this.attrs.post.id()]) {\r\n      delete app.cache.diffs[this.attrs.post.id()];\r\n    }\r\n  });\r\n\r\n  // prevent dropdown from closing when user\r\n  // clicks on deleted diff\r\n  extend(DiscussionPage.prototype, 'oninit', function () {\r\n    const $body = $('body');\r\n\r\n    $body.on('click', 'li.ParentDiff.DeletedDiff', function (e) {\r\n      e.stopPropagation();\r\n    });\r\n\r\n    $body.on('click', 'li.SubDiff', function (e) {\r\n      e.stopPropagation();\r\n    });\r\n  });\r\n});\r\n"],"sourceRoot":""}