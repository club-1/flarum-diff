{"version":3,"sources":["webpack://@the-turk/flarum-diff/webpack/bootstrap","webpack://@the-turk/flarum-diff/./forum.js","webpack://@the-turk/flarum-diff/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@the-turk/flarum-diff/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@the-turk/flarum-diff/./src/forum/components/DiffButton.js","webpack://@the-turk/flarum-diff/./src/forum/components/DiffDropdown.js","webpack://@the-turk/flarum-diff/./src/forum/components/DiffList.js","webpack://@the-turk/flarum-diff/./src/forum/components/DiffModal.js","webpack://@the-turk/flarum-diff/./src/forum/index.js","webpack://@the-turk/flarum-diff/./src/forum/models/Diff.js","webpack://@the-turk/flarum-diff/./src/forum/states/DiffListState.js","webpack://@the-turk/flarum-diff/./src/forum/utils/redrawPost.js","webpack://@the-turk/flarum-diff/./src/forum/utils/touchDevice.js","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/Component']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/Model']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/app']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Alert']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Button']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Dropdown']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Modal']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/components/Tooltip']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/extend']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/helpers/avatar']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/helpers/humanTime']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/helpers/icon']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/helpers/username']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/models/Post']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/utils/extractText']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['common/utils/mixin']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@the-turk/flarum-diff/external \"flarum.core.compat['forum/components/DiscussionPage']\""],"names":["_inheritsLoose","subClass","superClass","prototype","Object","create","constructor","setPrototypeOf","_setPrototypeOf","o","p","__proto__","DiffButton","view","attrs","assign","item","subButton","postDate","type","getButtonContent","revision","actor","buttonText","extractText","app","translator","trans","username","ago","humanTime","createdAt","deletedAt","deletedUser","avatar","icon","className","Button","DiffDropdown","initAttrs","buttonClassName","menuClassName","label","oninit","vnode","post","listState","DiffListState","getButton","vdom","title","onclick","bind","getMenu","revisionCount","showing","load","Dropdown","DiffList","state","pages","cache","diffs","id","length","map","tooltipClass","diffButton","number","component","selectedItem","modal","show","DiffModal","forModal","$listContainer","$","find","prop","siblings","removeClass","addClass","toggleSubDiff","oncreate","dom","data","tip","loading","LoadingIndicator","$selectedItem","$revisions","$scrollParent","css","window","scrollHandler","scrollTop","viewportHeight","height","contentTop","offset","top","contentHeight","scrollHeight","moreResults","loadMore","on","onremove","off","$subDiff","$parentDiff","$icon","toggle","hasClass","Component","diffId","comparisonBetween","JSON","parse","route","user","m","config","onupdate","old","setDiffContent","session","preferences","diffRenderer","hide","canDeleteEditHistory","canRollbackEditHistory","confirm","redraw","rollbackTo","request","url","forum","attribute","method","then","redrawPost","close","showAlert","content","diffSwitches","switchData","renderHtml","attributes","previewHtml","onready","animate","key","message","success","error","alerts","Alert","children","trust","contentType","diffContentHtml","$diffContainer","$previewContainer","$tooltip","$sideBySideButton","$inlineButton","$combinedButton","$previewButton","sideBySideHtml","parent","inlineHtml","combinedHtml","setInfoContent","html","is","savePreferences","preview","$infoContainer","infoContentHtml","Modal","initializers","add","store","models","diff","Diff","Post","Model","canViewEditHistory","extend","CommentPost","items","isEdited","isHidden","replace","isEditing","DiscussionPage","$body","e","stopPropagation","mixin","transformDate","rollbackedAt","hasOne","rollbackedUser","redrawList","params","page","parseResults","results","push","payload","links","next","save","touchDevice","DocumentTouch","document"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import Button from 'flarum/common/components/Button';\r\nimport avatar from 'flarum/common/helpers/avatar';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport username from 'flarum/common/helpers/username';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport extractText from 'flarum/common/utils/extractText';\r\n\r\n/**\r\n * The `DiffButton` component composes a button\r\n * for all revisions created in DiffList.\r\n */\r\nexport default class DiffButton extends Button {\r\n  // see the following link to find out why i'm overriding this at all\r\n  // https://discuss.flarum.org/d/22728-passing-an-object-to-a-custom-button-component\r\n  view() {\r\n    const attrs = Object.assign({}, this.attrs);\r\n\r\n    delete attrs.item;\r\n    delete attrs.subButton;\r\n    delete attrs.postDate;\r\n\r\n    attrs.type = 'button';\r\n\r\n    return <button {...attrs}>{this.getButtonContent()}</button>;\r\n  }\r\n\r\n  getButtonContent() {\r\n    const revision = this.attrs.item;\r\n    let actor = revision.actor();\r\n\r\n    let buttonText =\r\n      revision.revision() == 0\r\n        ? /* {username} created {ago} */\r\n          extractText(\r\n            app.translator.trans('the-turk-diff.forum.createdInfo', {\r\n              username: username(revision.actor()),\r\n              ago: humanTime(this.attrs.postDate),\r\n            })\r\n          )\r\n        : /* {username} edited {ago} */\r\n          extractText(\r\n            app.translator.trans('the-turk-diff.forum.editedInfo', {\r\n              username: username(revision.actor()),\r\n              ago: humanTime(revision.createdAt()),\r\n            })\r\n          );\r\n\r\n    if (revision.deletedAt()) {\r\n      if (this.attrs.subButton === false) {\r\n        /* {username} did something {ago} (deleted) */\r\n        buttonText = buttonText + ' ' + app.translator.trans('the-turk-diff.forum.deletedText');\r\n      } else {\r\n        /* sub button text that appears when you click on caret icon */\r\n        actor = revision.deletedUser();\r\n        /* {actor} deleted this content {ago} */\r\n        buttonText = extractText(\r\n          app.translator.trans('the-turk-diff.forum.deletedInfo', {\r\n            username: username(revision.deletedUser()),\r\n            ago: humanTime(revision.deletedAt()),\r\n          })\r\n        );\r\n      }\r\n    }\r\n\r\n    return [\r\n      // we also should consider deleted users here\r\n      actor.username() ? avatar(actor) : '',\r\n      // does this button have an icon?\r\n      revision.deletedAt() && this.attrs.subButton === false\r\n        ? icon('fas fa-caret-down', {\r\n            className: 'Button-caret',\r\n          })\r\n        : '',\r\n      // button label\r\n      <span className=\"Button-label\" title={buttonText}>\r\n        {revision.deletedAt() && this.attrs.subButton === true ? (\r\n          /* emphasize deleted revision's information */\r\n          <em>{buttonText}</em>\r\n        ) : (\r\n          buttonText\r\n        )}\r\n      </span>,\r\n    ];\r\n  }\r\n}\r\n","import Dropdown from 'flarum/common/components/Dropdown';\r\nimport DiffList from './DiffList';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport DiffListState from '../states/DiffListState';\r\n\r\n/**\r\n * The `DiffDropdown` component is the entrance point for this extension.\r\n * It's the component that you see when you click on \"Edited\" button.\r\n * It also contains DiffList components.\r\n */\r\nexport default class DiffDropdown extends Dropdown {\r\n  static initAttrs(attrs) {\r\n    attrs.className = 'DiffDropdown';\r\n    attrs.buttonClassName = 'Button Button--link';\r\n    attrs.menuClassName = attrs.menuClassName;\r\n    attrs.label = app.translator.trans('the-turk-diff.forum.editedText');\r\n    attrs.icon = 'fas fa-history';\r\n\r\n    super.initAttrs(attrs);\r\n  }\r\n\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    /**\r\n     * The post that we're working with.\r\n     *\r\n     * @type {Post[]}\r\n     */\r\n    this.post = this.attrs.post;\r\n\r\n    /**\r\n     * Create a new revision list.\r\n     *\r\n     * @type {DiffListState}\r\n     */\r\n    this.listState = new DiffListState(this.post, false, null);\r\n  }\r\n\r\n  getButton() {\r\n    const vdom = super.getButton();\r\n\r\n    vdom.attrs.title = this.attrs.label;\r\n    vdom.attrs.onclick = this.onclick.bind(this);\r\n\r\n    return vdom;\r\n  }\r\n\r\n  getButtonContent() {\r\n    return [\r\n      icon(this.attrs.icon, {\r\n        className: 'Button-icon',\r\n      }),\r\n      <span className=\"Button-label\">{this.attrs.label}</span>,\r\n    ];\r\n  }\r\n\r\n  getMenu() {\r\n    const revisionCount = this.attrs.post.revisionCount();\r\n\r\n    return (\r\n      <div className={'Dropdown-menu ' + this.attrs.menuClassName}>\r\n        <div className=\"DiffList-header\">\r\n          <h4>\r\n            {/* edited 1 time | edited x times */}\r\n            {app.translator.trans('the-turk-diff.forum.revisionInfo', { revisionCount })}\r\n          </h4>\r\n        </div>\r\n        {this.showing ? <DiffList state={this.listState}></DiffList> : ''}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Load revision list.\r\n   */\r\n  onclick() {\r\n    this.listState.load();\r\n  }\r\n}\r\n","import app from 'flarum/common/app';\r\nimport Component from 'flarum/common/Component';\r\nimport DiffButton from './DiffButton';\r\nimport DiffModal from './DiffModal';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Tooltip from 'flarum/common/components/Tooltip';\r\n\r\n/**\r\n * The `DiffList` component displays a list of the post's revisions.\r\n * It's been using on both DiffDropdown & DiffModal components.\r\n * It also contains DiffButton components.\r\n */\r\nexport default class DiffList extends Component {\r\n  view() {\r\n    const state = this.attrs.state;\r\n    const pages = app.cache.diffs[state.post.id()] || [];\r\n\r\n    return (\r\n      <div className=\"DiffList-container\">\r\n        <div className=\"DiffList-content\">\r\n          <ul>\r\n            {pages.length\r\n              ? pages.map((diffs) => {\r\n                  return diffs.map((item) => {\r\n                    // we can use this class to customize all tooltips\r\n                    // provided by this extension\r\n                    const tooltipClass = 'diffTooltip';\r\n\r\n                    let diffButton = (\r\n                      <Tooltip\r\n                        position=\"left\"\r\n                        text={\r\n                          item.revision() == state.post.revisionCount()\r\n                            ? // we're hovering on latest revision's button\r\n                              app.translator.trans('the-turk-diff.forum.tooltips.mostRecent')\r\n                            : item.revision() == 0\r\n                            ? // we're hovering on zeroth revision's button\r\n                              app.translator.trans('the-turk-diff.forum.tooltips.originalContent')\r\n                            : // we're hovering on other revision's button\r\n                              app.translator.trans('the-turk-diff.forum.tooltips.revisionWithNumber', {\r\n                                number: item.revision(),\r\n                              })\r\n                        }\r\n                      >\r\n                        {DiffButton.component({\r\n                          'data-container': 'body',\r\n                          postDate: state.post.createdAt(),\r\n                          subButton: false,\r\n                          item,\r\n                          onclick: () => {\r\n                            if (!item.deletedAt()) {\r\n                              state.selectedItem = item;\r\n                              app.modal.show(DiffModal, { listState: state });\r\n\r\n                              if (state.forModal) {\r\n                                // .DiffList-content container of clicked revision\r\n                                const $listContainer = this.$('li#parentDiff' + item.id());\r\n\r\n                                // disable clicked revision, enable others\r\n                                $listContainer.find('button').prop('disabled', true);\r\n                                $listContainer.siblings().find('button').prop('disabled', false);\r\n                                // add 'active' class to clicked revision, remove it from others\r\n                                $listContainer.siblings().removeClass('active');\r\n                                $listContainer.addClass('active');\r\n                              }\r\n                            } else {\r\n                              // if revision is deleted, we'll toggle the info\r\n                              // like GitHub does.\r\n                              this.toggleSubDiff(item.id());\r\n                            }\r\n                          },\r\n                          oncreate: (vnode) => {\r\n                            $(vnode.dom)\r\n                              // this is a workaround for adding custom\r\n                              // classes into bootstrap tooltips\r\n                              // https://stackoverflow.com/a/29879041/12866913\r\n                              .data('bs.tooltip')\r\n                              .tip()\r\n                              .addClass(item.deletedAt() ? tooltipClass + ' deletedDiffTooltip' : tooltipClass);\r\n                          },\r\n                        })}\r\n                      </Tooltip>\r\n                    );\r\n\r\n                    // returns the template for revision list items\r\n                    return [\r\n                      <li className={'Diff ParentDiff' + (item.deletedAt() ? ' DeletedDiff' : '')} id={'parentDiff' + item.id()}>\r\n                        {diffButton}\r\n                      </li>,\r\n                      item.deletedAt() ? (\r\n                        <li className=\"Diff SubDiff\" id={'subDiff' + item.id()}>\r\n                          <DiffButton postDate={state.post.createdAt()} subButton item={item} />\r\n                        </li>\r\n                      ) : (\r\n                        ''\r\n                      ),\r\n                    ];\r\n                  });\r\n                })\r\n              : ''}\r\n            {state.loading ? (\r\n              LoadingIndicator.component({\r\n                className: 'LoadingIndicator--block',\r\n              })\r\n            ) : !pages.length ? (\r\n              <div className=\"DiffList-empty\">{app.translator.trans('the-turk-diff.forum.emptyText')}</div>\r\n            ) : (\r\n              ''\r\n            )}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  oncreate(vnode) {\r\n    super.oncreate(vnode);\r\n    const state = this.attrs.state;\r\n\r\n    if (state.forModal && state.selectedItem) {\r\n      let $selectedItem = this.$('li#parentDiff' + state.selectedItem);\r\n      $selectedItem.find('button').prop('disabled', true);\r\n      $selectedItem.addClass('active');\r\n    }\r\n\r\n    const $revisions = this.$('.DiffList-content');\r\n    this.$scrollParent = $revisions.css('overflow') === 'auto' ? $revisions : $(window);\r\n\r\n    // Lazy-loading implementation for the revision list\r\n    // simply checks if we're bottom of the list\r\n    // and if there are more results to show\r\n    this.scrollHandler = () => {\r\n      const scrollTop = $scrollParent.scrollTop();\r\n      const viewportHeight = $scrollParent.height();\r\n      const contentTop = $scrollParent === $revisions ? 0 : $revisions.offset().top;\r\n      const contentHeight = $revisions[0].scrollHeight;\r\n\r\n      if (state.moreResults && !state.loading && scrollTop + viewportHeight >= contentTop + contentHeight) {\r\n        state.loadMore();\r\n      }\r\n    };\r\n\r\n    this.$scrollParent.on('scroll', this.scrollHandler);\r\n  }\r\n\r\n  onremove(vnode) {\r\n    this.$scrollParent.off('scroll', this.scrollHandler);\r\n  }\r\n\r\n  /**\r\n   * Toggle the deleted revision's information (sub-button).\r\n   *\r\n   * @param {Number} id\r\n   */\r\n  toggleSubDiff(id) {\r\n    const $subDiff = this.$('li.Diff#subDiff' + id);\r\n    const $parentDiff = this.$('li.Diff#parentDiff' + id);\r\n    const $icon = $parentDiff.find('.icon');\r\n\r\n    $subDiff.toggle();\r\n\r\n    // switch caret icon onClick\r\n    if ($icon.hasClass('fa-caret-down')) {\r\n      $icon.removeClass('fa-caret-down').addClass('fa-caret-up');\r\n    } else {\r\n      $icon.removeClass('fa-caret-up').addClass('fa-caret-down');\r\n    }\r\n  }\r\n}\r\n","import app from 'flarum/common/app';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Tooltip from 'flarum/common/components/Tooltip';\r\nimport username from 'flarum/common/helpers/username';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport avatar from 'flarum/common/helpers/avatar';\r\nimport extractText from 'flarum/common/utils/extractText';\r\nimport touchDevice from '../utils/touchDevice';\r\nimport redrawPost from '../utils/redrawPost';\r\nimport Alert from 'flarum/common/components/Alert';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Dropdown from 'flarum/common/components/Dropdown';\r\nimport DiffList from './DiffList';\r\nimport DiffListState from '../states/DiffListState';\r\n\r\n/**\r\n * The `DiffModal` component is the main component of this extension.\r\n * It also contains DiffList components.\r\n */\r\nexport default class DiffModal extends Modal {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    /**\r\n     * Whether or not the modal is loading.\r\n     *\r\n     * @type {Boolean}\r\n     */\r\n    this.loading = false;\r\n\r\n    /**\r\n     * Whether the modal is showing or not.\r\n     *\r\n     * @type {Boolean}\r\n     */\r\n    this.showing = false;\r\n\r\n    /**\r\n     * We will use this to change modal's content when\r\n     * user clicks on a revision on the list.\r\n     *\r\n     * @type {Number|Null}\r\n     */\r\n    this.diffId = null;\r\n\r\n    /**\r\n     * This holds information about which revisions are subjects for comparison.\r\n     *\r\n     * @type {Object}\r\n     */\r\n    this.comparisonBetween = JSON.parse(this.attrs.listState.selectedItem.comparisonBetween());\r\n  }\r\n\r\n  className() {\r\n    return 'DiffModal';\r\n  }\r\n\r\n  title() {\r\n    return [\r\n      // we also should consider deleted users here\r\n      this.attrs.listState.selectedItem.actor().username() ? avatar(this.attrs.listState.selectedItem.actor()) : '',\r\n      this.attrs.listState.selectedItem.revision() != 0\r\n        ? // x edited y ago\r\n          app.translator.trans('the-turk-diff.forum.editedInfo', {\r\n            username: (\r\n              <a href={app.route.user(this.attrs.listState.selectedItem.actor())} config={m.route}>\r\n                {username(this.attrs.listState.selectedItem.actor())}\r\n              </a>\r\n            ),\r\n            ago: humanTime(this.attrs.listState.selectedItem.createdAt()),\r\n          })\r\n        : // x created y ago\r\n          app.translator.trans('the-turk-diff.forum.createdInfo', {\r\n            username: (\r\n              <a href={app.route.user(this.attrs.listState.selectedItem.actor())} config={m.route}>\r\n                {username(this.attrs.listState.selectedItem.actor())}\r\n              </a>\r\n            ),\r\n            ago: humanTime(this.attrs.listState.post.createdAt()),\r\n          }),\r\n    ];\r\n  }\r\n\r\n  oncreate(vnode) {\r\n    super.oncreate(vnode);\r\n\r\n    this.config(vnode);\r\n  }\r\n\r\n  onupdate(vnode) {\r\n    this.config(vnode);\r\n  }\r\n\r\n  config(vnode) {\r\n    // workaround for missing 'in' class on .ModalManager\r\n    // after redrawing the DiffList component.\r\n    // because i'm done with this shit.\r\n    // https://github.com/flarum/core/pull/2080\r\n    if (this.showing && !$('.ModalManager').hasClass('in')) $('.ModalManager').addClass('in');\r\n\r\n    // we should re-Initialize this component after user\r\n    // clicks a different revision while modal is open\r\n    if (this.diffId === this.attrs.listState.selectedItem.id()) return;\r\n\r\n    this.showing = true;\r\n    this.diffId = this.attrs.listState.selectedItem.id();\r\n\r\n    this.comparisonBetween = JSON.parse(this.attrs.listState.selectedItem.comparisonBetween());\r\n\r\n    if (this.attrs.listState.selectedItem.revision() != 0 && this.comparisonBetween.new.revision != this.comparisonBetween.old.revision) {\r\n      // we'll use Side By Side renderer as a fallback\r\n      // if there is no renderer choice\r\n      return this.setDiffContent(app.session.user.preferences().diffRenderer ? app.session.user.preferences().diffRenderer : 'sideBySide');\r\n    } else {\r\n      return this.setDiffContent('preview');\r\n    }\r\n  }\r\n\r\n  view() {\r\n    return (\r\n      <div className={'Modal modal-dialog ' + this.className()}>\r\n        <div className=\"Modal-content\">\r\n          <div className=\"Modal-close App-backControl\">\r\n            {Button.component({\r\n              icon: 'fas fa-times',\r\n              onclick: this.hide.bind(this),\r\n              className: 'Button Button--icon Button--link',\r\n            })}\r\n          </div>\r\n          {\r\n            // Revision Options Button\r\n          }\r\n          {(this.attrs.listState.post.canDeleteEditHistory() &&\r\n            this.attrs.listState.selectedItem.revision() != this.attrs.listState.post.revisionCount()) ||\r\n          (this.attrs.listState.post.canRollbackEditHistory() && this.$('.DeletedDiff').length != this.attrs.listState.post.revisionCount()) ? (\r\n            <Dropdown\r\n              className=\"diffCotrollerDropdown App-primaryControl\"\r\n              icon=\"fas fa-ellipsis-v\"\r\n              buttonClassName=\"Button\"\r\n              menuClassName=\"Dropdown-menu--right\"\r\n              label={app.translator.trans('the-turk-diff.forum.optionsButton')}\r\n            >\r\n              {\r\n                // Rollback\r\n                // there must be a revision to rollback,\r\n                // as we can't rollback to current post.\r\n              }\r\n              {this.attrs.listState.post.canRollbackEditHistory() && this.comparisonBetween.old.diffId\r\n                ? Button.component(\r\n                    {\r\n                      icon: 'fas fa-reply',\r\n                      onclick: () => {\r\n                        if (\r\n                          confirm(\r\n                            app.translator.trans('the-turk-diff.forum.confirmRollback', {\r\n                              number: this.attrs.listState.selectedItem.revision(),\r\n                            })\r\n                          )\r\n                        ) {\r\n                          this.loading = true;\r\n                          m.redraw();\r\n\r\n                          let rollbackTo =\r\n                            this.attrs.listState.selectedItem.revision() == this.attrs.listState.post.revisionCount()\r\n                              ? this.comparisonBetween.old.diffId\r\n                              : this.attrs.listState.selectedItem.id();\r\n\r\n                          app\r\n                            .request({\r\n                              url: `${app.forum.attribute('apiUrl')}/diff/${rollbackTo}`,\r\n                              method: 'POST',\r\n                            })\r\n                            .then(() => {\r\n                              redrawPost(this.attrs.listState.post);\r\n                              app.modal.close();\r\n\r\n                              if (app.cache.diffs && app.cache.diffs[this.attrs.listState.post.id()]) {\r\n                                delete app.cache.diffs[this.attrs.listState.post.id()];\r\n                              }\r\n\r\n                              this.showAlert('success', 'rollback');\r\n                            })\r\n                            .catch(() => {\r\n                              this.loading = false;\r\n                              m.redraw();\r\n                              redrawPost(this.attrs.listState.post);\r\n\r\n                              this.showAlert('error', 'rollback');\r\n                            });\r\n                        }\r\n                      },\r\n                    },\r\n                    this.attrs.listState.selectedItem.revision() == 0\r\n                      ? /* we're viewing the original content */\r\n                        app.translator.trans('the-turk-diff.forum.rollbackToOriginalButton')\r\n                      : this.attrs.listState.selectedItem.revision() == this.attrs.listState.post.revisionCount()\r\n                      ? this.comparisonBetween.old.revision != 0\r\n                        ? /* we're comparing this revision with current content. */\r\n                          app.translator.trans('the-turk-diff.forum.revertChangesButton')\r\n                        : /* we're comparing this revision with original content */\r\n                          app.translator.trans('the-turk-diff.forum.rollbackToOriginalButton')\r\n                      : /* we're comparing this revision with another revision */\r\n                        app.translator.trans('the-turk-diff.forum.rollbackButton', {\r\n                          number: this.attrs.listState.selectedItem.revision(),\r\n                        })\r\n                  )\r\n                : ''}\r\n\r\n              {\r\n                // Delete\r\n                // you can't delete last item on the list\r\n                // because it's the current post actually.\r\n              }\r\n              {this.attrs.listState.post.canDeleteEditHistory() &&\r\n              this.attrs.listState.selectedItem.revision() != this.attrs.listState.post.revisionCount()\r\n                ? Button.component(\r\n                    {\r\n                      icon: 'far fa-trash-alt',\r\n                      onclick: () => {\r\n                        if (confirm(app.translator.trans('the-turk-diff.forum.confirmDelete'))) {\r\n                          this.loading = true;\r\n                          m.redraw();\r\n\r\n                          this.attrs.listState.selectedItem\r\n                            .delete()\r\n                            .then(() => {\r\n                              app.modal.close();\r\n\r\n                              if (app.cache.diffs && app.cache.diffs[this.attrs.listState.post.id()]) {\r\n                                delete app.cache.diffs[this.attrs.listState.post.id()];\r\n                              }\r\n\r\n                              this.showAlert('success', 'delete');\r\n                            })\r\n                            .catch(() => {\r\n                              this.loading = false;\r\n                              m.redraw();\r\n\r\n                              this.showAlert('error', 'delete');\r\n                            });\r\n                        }\r\n                      },\r\n                    },\r\n                    app.translator.trans('the-turk-diff.forum.deleteButton')\r\n                  )\r\n                : ''}\r\n            </Dropdown>\r\n          ) : (\r\n            ''\r\n          )}\r\n\r\n          <div className=\"Modal-header\">\r\n            <h3 className=\"App-titleControl App-titleControl--text\">{this.title()}</h3>\r\n          </div>\r\n          {this.content()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  content() {\r\n    // we can use this class to customize all tooltips\r\n    // provided by this extension\r\n    const tooltipClass = 'diffTooltip';\r\n    const revisionCount = this.attrs.listState.post.revisionCount();\r\n\r\n    /**\r\n     * `type` is passed to `setDiffContent` and the tooltip.\r\n     */\r\n    const diffSwitches = [\r\n      {\r\n        type: 'inline',\r\n        icon: 'fas fa-grip-lines',\r\n        class: 'inlineView',\r\n      },\r\n      {\r\n        type: 'sideBySide',\r\n        icon: 'fas fa-columns',\r\n        class: 'sideBySideView',\r\n      },\r\n      {\r\n        type: 'combined',\r\n        icon: 'far fa-square',\r\n        class: 'combinedView',\r\n      },\r\n    ];\r\n\r\n    return [\r\n      <div className=\"diff-grid\">\r\n        {/* Renderer Switcher Container */}\r\n        <div className=\"diff-grid-item diff-grid-controls\">\r\n          <div className=\"diffSwitcher\">\r\n            {this.attrs.listState.selectedItem.revision() != 0 && this.comparisonBetween.new.revision != this.comparisonBetween.old.revision\r\n              ? diffSwitches.map((switchData) => (\r\n                  <Tooltip text={app.translator.trans(`the-turk-diff.forum.tooltips.${switchData.type}`)}>\r\n                    <div className=\"tooltip-wrapper\">\r\n                      <Button\r\n                        icon={switchData.icon}\r\n                        onclick={() => this.setDiffContent(switchData.type)}\r\n                        className={`Button Button--icon Button--link ${switchData.class}`}\r\n                      />\r\n                    </div>\r\n                  </Tooltip>\r\n                ))\r\n              : ''}\r\n            <Tooltip text={app.translator.trans('the-turk-diff.forum.tooltips.preview')}>\r\n              <div className=\"tooltip-wrapper\">\r\n                <Button icon=\"far fa-eye\" onclick={() => this.setDiffContent('preview')} className=\"Button Button--icon Button--link diffPreview\" />\r\n              </div>\r\n            </Tooltip>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Comparison Info Container */}\r\n        <div className=\"diff-grid-item diff-grid-info\">\r\n          <div className=\"revisionInfo\">\r\n            <h4>{app.translator.trans('the-turk-diff.forum.revisions', { revisionCount })}</h4>\r\n            <p class=\"diffInfoContainer\" />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Revision List Container */}\r\n        <div className=\"diff-grid-item diff-grid-revisions\">\r\n          <DiffList state={this.attrs.listState}></DiffList>\r\n        </div>\r\n\r\n        {/* Diffs Container */}\r\n        <div className=\"diff-grid-item diff-grid-diff\">\r\n          <div className=\"diffContents\">\r\n            {\r\n              // .previewContainer is hidden by default\r\n              // we'll do some nasty switches later\r\n            }\r\n            <div\r\n              className={\r\n                'previewContainer Post-body' + (app.forum.attribute('textFormattingForDiffPreviews') === false ? ' diff-skip-formatting' : '')\r\n              }\r\n            >\r\n              {this.renderHtml(this.attrs.listState.selectedItem.data.attributes.previewHtml)}\r\n            </div>\r\n            <div className=\"diffContainer\" />\r\n          </div>\r\n        </div>\r\n        {LoadingIndicator.component({\r\n          className: 'DiffModal-loading' + (this.loading ? ' active' : ''),\r\n        })}\r\n      </div>,\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Slowly scroll to selected revision.\r\n   */\r\n  onready() {\r\n    const $revisions = this.$('.DiffList-content');\r\n    let $selectedItem = this.$('li#parentDiff' + this.attrs.listState.selectedItem.id());\r\n\r\n    $revisions.animate({\r\n      scrollTop: $selectedItem.offset().top - $revisions.offset().top + $revisions.scrollTop(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show success and error messages for rollback and delete operations.\r\n   *\r\n   * @param {string} type\r\n   * @param {string} key\r\n   */\r\n  showAlert(type, key) {\r\n    const message = {\r\n      success: 'the-turk-diff.forum.' + key + 'SuccessMessage',\r\n      error: 'the-turk-diff.forum.' + key + 'ErrorMessage',\r\n    }[type];\r\n\r\n    app.alerts.show(Alert, {\r\n      type,\r\n      children: app.translator.trans(message),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Render the diff views provided by external lib.\r\n   *\r\n   * do we need to worry about m.trust() function?\r\n   * well, Flarum itself doing the same way for rendering\r\n   * post items as seen on CommentPost.js#L52\r\n   * also, the diff library itself treat all inputs as plain text:\r\n   * https://github.com/jfcherng/php-diff/issues/9#issuecomment-526808774\r\n   * so no need to use additional Sanitizer lib for this operation.\r\n   *\r\n   * @param {string} content\r\n   */\r\n  renderHtml(content) {\r\n    return m.trust(content);\r\n  }\r\n\r\n  /**\r\n   * Insert rendered diff views into their container\r\n   * and disable active views' buttons.\r\n   * Disabling buttons is just for indicating\r\n   * so frontend looks good but the backend sucks.\r\n   *\r\n   * @param {string} contentType\r\n   */\r\n  setDiffContent(contentType) {\r\n    let diffContentHtml;\r\n    const $diffContainer = this.$('.diffContainer');\r\n    const $previewContainer = this.$('.previewContainer');\r\n    const $tooltip = this.$('.diffTooltip');\r\n\r\n    // buttons\r\n    const $sideBySideButton = this.$('.Button.sideBySideView');\r\n    const $inlineButton = this.$('.Button.inlineView');\r\n    const $combinedButton = this.$('.Button.combinedView');\r\n    const $previewButton = this.$('.Button.diffPreview');\r\n\r\n    if (contentType !== 'preview') {\r\n      if (contentType === 'sideBySide') {\r\n        diffContentHtml = this.renderHtml(this.attrs.listState.selectedItem.data.attributes.sideBySideHtml);\r\n        $sideBySideButton.prop('disabled', true);\r\n        // what a dynasty - LOL\r\n        $sideBySideButton.parent().siblings().children().prop('disabled', false);\r\n      } else if (contentType === 'inline') {\r\n        diffContentHtml = this.renderHtml(this.attrs.listState.selectedItem.data.attributes.inlineHtml);\r\n        $inlineButton.prop('disabled', true);\r\n        $inlineButton.parent().siblings().children().prop('disabled', false);\r\n      } else if (contentType === 'combined') {\r\n        diffContentHtml = this.renderHtml(this.attrs.listState.selectedItem.data.attributes.combinedHtml);\r\n        $combinedButton.prop('disabled', true);\r\n        $combinedButton.parent().siblings().children().prop('disabled', false);\r\n      }\r\n    } else {\r\n      $diffContainer.hide();\r\n      this.$('.previewContainer').show();\r\n\r\n      $previewButton.prop('disabled', true);\r\n      $previewButton.parent().siblings().children().prop('disabled', false);\r\n      return this.setInfoContent(true);\r\n    }\r\n\r\n    if (diffContentHtml) {\r\n      $diffContainer.html(diffContentHtml.children);\r\n\r\n      if ($previewContainer.is(':visible')) {\r\n        $diffContainer.show();\r\n        $previewContainer.hide();\r\n      }\r\n\r\n      // let's remember their renderer choice\r\n      app.session.user.savePreferences({\r\n        diffRenderer: contentType,\r\n      });\r\n\r\n      return this.setInfoContent();\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Set informations about comparisons.\r\n   *\r\n   * @param {Boolean} preview\r\n   */\r\n  setInfoContent(preview = false) {\r\n    const $infoContainer = this.$('.diffInfoContainer');\r\n\r\n    let infoContentHtml =\r\n      !preview && this.attrs.listState.selectedItem.revision() != 0 && this.comparisonBetween.new.revision != this.comparisonBetween.old.revision\r\n        ? extractText(\r\n            app.translator.trans('the-turk-diff.forum.differences.sentence', {\r\n              old:\r\n                this.comparisonBetween.old.revision == -1\r\n                  ? /* we're viewing differences between current content and {new} */\r\n                    app.translator.trans('the-turk-diff.forum.differences.currentContent')\r\n                  : this.comparisonBetween.old.revision == 0\r\n                  ? /* we're viewing differences between original content and {new} */\r\n                    app.translator.trans('the-turk-diff.forum.differences.originalContent')\r\n                  : /* we're viewing differences between revision X and {new} */\r\n                    app.translator.trans('the-turk-diff.forum.differences.revisionWithNumber', {\r\n                      number: this.comparisonBetween.old.revision,\r\n                    }),\r\n              new:\r\n                this.comparisonBetween.new.revision == 0\r\n                  ? /* we're viewing differences between {old} and original content */\r\n                    app.translator.trans('the-turk-diff.forum.differences.originalContent')\r\n                  : this.comparisonBetween.new.revision == this.attrs.listState.post.revisionCount()\r\n                  ? /* we're viewing differences between {old} and current content */\r\n                    app.translator.trans('the-turk-diff.forum.differences.currentContent')\r\n                  : /* we're viewing differences between {old} and revision X */\r\n                    app.translator.trans('the-turk-diff.forum.differences.revisionWithNumber', {\r\n                      number: this.comparisonBetween.new.revision,\r\n                    }),\r\n            })\r\n          )\r\n        : extractText(\r\n            app.translator.trans('the-turk-diff.forum.previewMode.sentence', {\r\n              content:\r\n                this.comparisonBetween.new.revision == 0\r\n                  ? /* we're previewing original content */\r\n                    app.translator.trans('the-turk-diff.forum.previewMode.originalContent')\r\n                  : this.comparisonBetween.new.revision == this.attrs.listState.post.revisionCount()\r\n                  ? /* we're previewing current content */\r\n                    app.translator.trans('the-turk-diff.forum.previewMode.currentContent')\r\n                  : /* we're previewing revision X */\r\n                    app.translator.trans('the-turk-diff.forum.previewMode.revisionWithNumber', {\r\n                      number: this.comparisonBetween.new.revision,\r\n                    }),\r\n            })\r\n          );\r\n\r\n    return $infoContainer.html(infoContentHtml);\r\n  }\r\n}\r\n","import app from 'flarum/common/app';\r\nimport { extend } from 'flarum/common/extend';\r\nimport CommentPost from 'flarum/forum/components/CommentPost';\r\nimport Diff from './models/Diff';\r\nimport Post from 'flarum/common/models/Post';\r\nimport Model from 'flarum/common/Model';\r\nimport DiffDropdown from './components/DiffDropdown';\r\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\r\n\r\napp.initializers.add('the-turk-diff', () => {\r\n  app.store.models.diff = Diff;\r\n  Post.prototype.revisionCount = Model.attribute('revisionCount');\r\n  Post.prototype.canViewEditHistory = Model.attribute('canViewEditHistory');\r\n  Post.prototype.canRollbackEditHistory = Model.attribute('canRollbackEditHistory');\r\n  Post.prototype.canDeleteEditHistory = Model.attribute('canDeleteEditHistory');\r\n\r\n  extend(CommentPost.prototype, 'headerItems', function (items) {\r\n    const post = this.attrs.post;\r\n\r\n    // replace \"edited\" text to \"edited\" button\r\n    if (post.isEdited() && !post.isHidden() && post.canViewEditHistory() && post.revisionCount() > 0) {\r\n      items.replace('edited', DiffDropdown.component({ post }));\r\n    }\r\n\r\n    // remove diffs cache when post is editing\r\n    if (this.isEditing() && app.cache.diffs && app.cache.diffs[this.attrs.post.id()]) {\r\n      delete app.cache.diffs[this.attrs.post.id()];\r\n    }\r\n  });\r\n\r\n  // prevent dropdown from closing when user\r\n  // clicks on deleted diff\r\n  extend(DiscussionPage.prototype, 'oninit', function () {\r\n    const $body = $('body');\r\n\r\n    $body.on('click', 'li.ParentDiff.DeletedDiff', function (e) {\r\n      e.stopPropagation();\r\n    });\r\n\r\n    $body.on('click', 'li.SubDiff', function (e) {\r\n      e.stopPropagation();\r\n    });\r\n  });\r\n});\r\n","import Model from 'flarum/common/Model';\r\nimport mixin from 'flarum/common/utils/mixin';\r\n\r\nexport default class Diff extends mixin(Model, {\r\n  revision: Model.attribute('revision'),\r\n  createdAt: Model.attribute('createdAt', Model.transformDate),\r\n  deletedAt: Model.attribute('deletedAt', Model.transformDate),\r\n  rollbackedAt: Model.attribute('rollbackedAt', Model.transformDate),\r\n  actor: Model.hasOne('actor'),\r\n  deletedUser: Model.hasOne('deletedUser'),\r\n  rollbackedUser: Model.hasOne('rollbackedUser'),\r\n  inlineHtml: Model.attribute('inlineHtml'),\r\n  sideBySideHtml: Model.attribute('sideBySideHtml'),\r\n  combinedHtml: Model.attribute('combinedHtml'),\r\n  previewHtml: Model.attribute('previewHtml'),\r\n  comparisonBetween: Model.attribute('comparisonBetween'),\r\n}) {}\r\n","import redrawPost from '../utils/redrawPost';\r\n\r\nexport default class DiffListState {\r\n  constructor(post, forModal, moreResults, selectedItem) {\r\n    this.post = post;\r\n    this.forModal = forModal;\r\n    this.moreResults = moreResults || false;\r\n    this.selectedItem = selectedItem;\r\n    this.loading = false;\r\n\r\n    if (!app.cache.diffs) {\r\n      app.cache.diffs = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load revisions.\r\n   *\r\n   * @public\r\n   */\r\n  load() {\r\n    // don't do anthing if we already cached revisions for the post.\r\n    // lazy-loading will perform loadMore() if there are moreResults\r\n    if (app.cache.diffs[this.post.id()]) return this.redrawList();\r\n\r\n    this.loadMore();\r\n  }\r\n\r\n  /**\r\n   * Load the next page of revision results.\r\n   *\r\n   * @public\r\n   */\r\n  loadMore() {\r\n    this.loading = true;\r\n    this.redrawList();\r\n\r\n    // don't do anthing if we already cached ALL revisions for the post.\r\n    if (app.cache.diffs[this.post.id()] && app.cache.diffs[this.post.id()].length == this.post.revisionCount()) {\r\n      return;\r\n    }\r\n\r\n    // set URL parameters\r\n    const params = app.cache.diffs[this.post.id()]\r\n      ? {\r\n          id: this.post.id(),\r\n          page: {\r\n            offset: app.cache.diffs[this.post.id()].length * 10,\r\n          },\r\n        }\r\n      : {\r\n          id: this.post.id(),\r\n        };\r\n\r\n    return app.store\r\n      .find('diff', params)\r\n      .then(this.parseResults.bind(this))\r\n      .catch(() => {})\r\n      .then(() => {\r\n        this.loading = false;\r\n        this.redrawList();\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Parse results and append them to the revision list.\r\n   *\r\n   * @param {Diff[]} results\r\n   * @return {Diff[]}\r\n   */\r\n  parseResults(results) {\r\n    app.cache.diffs[this.post.id()] = app.cache.diffs[this.post.id()] || [];\r\n\r\n    if (results.length) app.cache.diffs[this.post.id()].push(results);\r\n\r\n    this.moreResults = !!results.payload.links.next;\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Redraw the list based on parent component.\r\n   */\r\n  redrawList() {\r\n    m.redraw();\r\n\r\n    // because we don't need to redraw the post\r\n    // to update DiffList in DiffModal.\r\n    // We just need it for updating DiffDropdown.\r\n    if (this.forModal) return;\r\n\r\n    return redrawPost(this.post);\r\n  }\r\n}\r\n","/**\r\n * Redraw the post.\r\n * Workaround for - SubtreeRetainer doesn't allow redrawing post\r\n * https://discuss.flarum.org/d/22755-mithril-related-issues-on-poststream-items\r\n *\r\n * @param {Object} post\r\n */\r\nexport default function redrawPost(post) {\r\n  return post.save({}).then(() => m.redraw());\r\n}\r\n","/**\r\n * Tooltips will be skipped for touch devices. Because they're forcing users\r\n * to double click the buttons. They also working unstable and won't fit to\r\n * screen sometimes. I'm planning to deal with them later on next versions.\r\n * https://stackoverflow.com/a/24647710/12866913\r\n */\r\nexport default function touchDevice() {\r\n  return true == ('ontouchstart' in window || (window.DocumentTouch && document instanceof DocumentTouch));\r\n}\r\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/app'];","module.exports = flarum.core.compat['common/components/Alert'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/Dropdown'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/components/Modal'];","module.exports = flarum.core.compat['common/components/Tooltip'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/helpers/avatar'];","module.exports = flarum.core.compat['common/helpers/humanTime'];","module.exports = flarum.core.compat['common/helpers/icon'];","module.exports = flarum.core.compat['common/helpers/username'];","module.exports = flarum.core.compat['common/models/Post'];","module.exports = flarum.core.compat['common/utils/extractText'];","module.exports = flarum.core.compat['common/utils/mixin'];","module.exports = flarum.core.compat['forum/components/CommentPost'];","module.exports = flarum.core.compat['forum/components/DiscussionPage'];"],"sourceRoot":""}